<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

	<title><![CDATA[Gorille Gris]]></title>
	<link href="http://ptitgraig.github.io/atom.xml" rel="self"/>
	<link href="http://ptitgraig.github.io/"/>
	<updated>2015-01-14T15:21:16+01:00</updated>
	<id>http://ptitgraig.github.io/</id>
	<author>
		<name><![CDATA[Grégory Pelletey]]></name>
		
	</author>
	<generator uri="http://octopress.org/">Octopress</generator>

	
	<entry>
		
			<title type="html"><![CDATA[Introduction au test unitaire JavaScript]]></title>
		
		<link href="http://ptitgraig.github.io/blog/2015/01/08/introduction-au-test-unitaire-javascript/"/>
		<updated>2015-01-08T17:46:00+01:00</updated>
		<id>http://ptitgraig.github.io/blog/2015/01/08/introduction-au-test-unitaire-javascript</id>
		<content type="html">
			<![CDATA[
				
					<p></p>
				
			]]>
			<![CDATA[<p class="foreword">
Traduction de l&#8217;article du Smashing Magazine : Introduction To JavaScript Unit Testing, écrit par Jörn Zaefferer en Juillet 2012.
</p>
<!-- more -->

<p class="disclaimer">
<a href="https://github.com/ptitgraig/first-step-unit-js-tests">Le code étape par étape est disponible sur GitHub.</a>
</p>

<p>Vous savez probablement que le test est une bonne chose, mais le premier obstacle à surmonter en essayant d’écrire des tests unitaires pour du code client est le manque de toutes les unités; le code JavaScript est écrit pour chaque page d’un site Web ou chaque module d’une application et est étroitement mélangés avec la logique back-end et le HTML correspondant. Dans le pire des cas, le code est complètement mélangé avec le langage HTML, comme les gestionnaires d’événements directement dans le markup.</p>

<p>Ce est probablement le cas lorsqu’on utilise aucune bibliothèque JavaScript, qui permettrait une abstraction du DOM; l’écriture de gestionnaires d’événements directement dans le markup est beaucoup plus facile que d’utiliser les API DOM pour lier ces événements.
De plus en plus de développeurs choisissent une bibliothèque comme jQuery pour gérer l’abstraction du DOM. Ceci leur permet de déplacer la gestion des ces événements dans un script distinct, soit sur ​​la même page ou dans un fichier JavaScript à part. Toutefois, mettre le code dans des fichiers séparés ne signifie pas qu’il est prêt à être testé unitairement.</p>

<p>Qu’est ce qu’une unité de toute façon? Dans le meilleur des cas, c’est une fonction que vous pouvez gérer de différentes façon - une fonction qui vous donne toujours le même résultat pour une entrée donnée. C’est ce qui rend les tests unitaires assez facile, mais la plupart du temps il faut gérer les effets secondaires, entre autre : la manipulations du DOM. Il est utile de trouver quelles sont ces unités qui permettront la structure de notre code et de construire les tests unitaire en conséquence.</p>

<h2 id="construire-des-tests-unitaires">Construire des tests unitaires</h2>

<p>Cela étant dit, commencer avec les tests unitaires est bien plus facile quand on commence de rien. Mais cet article ne parle pas de ce cas là. Cet article est là pour vous aider sur le problème le plus difficile : partir sur du code existant, en tester les parties importantes et éventuellement en corriger les bugs.</p>

<p>Le processus d’extraction de code et de son changement de forme, sans en modifier son comportement, est appelé refactorisation. C’est une excellente méthode pour améliorer la manière dont le code est conçu un programme. Et puisque la moindre modification peut potentiellement changer le comportement du programme, il est plus sûr de le faire quand les tests unitaires sont en place.</p>

<p>Cela veut dire que pour ajouter des tests unitaire, vous devez prendre le risque de casser des choses : c’est le problème de l’oeuf et de la poule (qui est venu le premier ?). Donc, avant que vous ayez une bonne couverture de test unitaire, vous devez continuer à tester manuellement pour minimiser le risque de régression.</p>

<p>Assez de théorie ! Passons à la pratique : tester du code JavaScript mélangé au HTML et relié à une page. Ce code a pour but de chercher tous les liens qui possède un attribut <code>title</code>. Ces attributs <code>title</code> sont utilisés pour afficher, quand quelque chose a été posté, une date relative du genre <em>il y a 5 jours</em> :</p>

<div><div class="CodeRay">
  <div class="code"><pre><span class="tag">&lt;html&gt;</span>
<span class="tag">&lt;head&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">http-equiv</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/html; charset=UTF-8</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;title&gt;</span>Test unitaire sur date<span class="tag">&lt;/title&gt;</span>
    <span class="tag">&lt;script&gt;</span>
<span class="inline">    <span class="keyword">function</span> <span class="function">prettyDate</span>(time){
        <span class="keyword">var</span> date = <span class="keyword">new</span> Date(time || <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>),
            diff = ((<span class="keyword">new</span> Date().getTime() - date.getTime()) / <span class="integer">1000</span>),
            day_diff = Math.floor(diff / <span class="integer">86400</span>);

        <span class="keyword">if</span> (isNaN(day_diff) || day_diff &lt; <span class="integer">0</span> || day_diff &gt;= <span class="integer">31</span>) {
            <span class="keyword">return</span>;
        }

        <span class="keyword">return</span> day_diff == <span class="integer">0</span> &amp;&amp; (
                diff &lt; <span class="integer">60</span> &amp;&amp; <span class="string"><span class="delimiter">&quot;</span><span class="content">à l'instant</span><span class="delimiter">&quot;</span></span> ||
                diff &lt; <span class="integer">120</span> &amp;&amp; <span class="string"><span class="delimiter">&quot;</span><span class="content">1 minute</span><span class="delimiter">&quot;</span></span> ||
                diff &lt; <span class="integer">3600</span> &amp;&amp; Math.floor( diff / <span class="integer">60</span> ) + <span class="string"><span class="delimiter">&quot;</span><span class="content"> minutes</span><span class="delimiter">&quot;</span></span> ||
                diff &lt; <span class="integer">7200</span> &amp;&amp; <span class="string"><span class="delimiter">&quot;</span><span class="content">1 heure</span><span class="delimiter">&quot;</span></span> ||
                diff &lt; <span class="integer">86400</span> &amp;&amp; Math.floor( diff / <span class="integer">3600</span> ) + <span class="string"><span class="delimiter">&quot;</span><span class="content"> heures</span><span class="delimiter">&quot;</span></span>) ||
            day_diff == <span class="integer">1</span> &amp;&amp; <span class="string"><span class="delimiter">&quot;</span><span class="content">Hier</span><span class="delimiter">&quot;</span></span> ||
            day_diff &lt; <span class="integer">7</span> &amp;&amp; day_diff + <span class="string"><span class="delimiter">&quot;</span><span class="content"> days ago</span><span class="delimiter">&quot;</span></span> ||
            day_diff &lt; <span class="integer">31</span> &amp;&amp; Math.ceil( day_diff / <span class="integer">7</span> ) + <span class="string"><span class="delimiter">&quot;</span><span class="content"> semaines</span><span class="delimiter">&quot;</span></span>;
    }
    window.<span class="function">onload</span> = <span class="keyword">function</span>(){
        <span class="keyword">var</span> links = document.getElementsByTagName(<span class="string"><span class="delimiter">&quot;</span><span class="content">a</span><span class="delimiter">&quot;</span></span>);
        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="integer">0</span>; i &lt; links.length; i++) {
            <span class="keyword">if</span> (links[i].title) {
                <span class="keyword">var</span> date = prettyDate(links[i].title);
                <span class="keyword">if</span> (date) {
                    links[i].innerHTML = date;
                }
            }
        }
    };</span>
    <span class="tag">&lt;/script&gt;</span>
<span class="tag">&lt;/head&gt;</span>
<span class="tag">&lt;body&gt;</span>

<span class="tag">&lt;ul&gt;</span>
<span class="tag">&lt;li</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">entry</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">post57</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;p&gt;</span>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Curabitur dignissim quis libero eu lobortis. <span class="tag">&lt;/p&gt;</span>
    <span class="tag">&lt;small</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">extra</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        Posté il y a <span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/2008/01/blah/57/</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2008-01-28T21:24:17Z</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>January 28th, 2008<span class="tag">&lt;/a&gt;</span>
        par <span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/john/</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>John Resig<span class="tag">&lt;/a&gt;</span>
    <span class="tag">&lt;/small&gt;</span>
<span class="tag">&lt;/li&gt;</span>
<span class="comment">&lt;!-- more list items --&gt;</span>
<span class="tag">&lt;/ul&gt;</span>

<span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span>
</pre></div>
</div>
</div>

<p>Si vous exécuter cet exemple dans une navigateur, vous remarquerez un problème : aucune date n’est remplacée. Le code fonctionne cependant correctement. Il boucle bien sur tous les liens de la page et vérifie, pour chacun, si l’attribut <code>title</code> est présent. Si il y en a bien un, il passe dans la fonction <code>prettyDate</code>. Si <code>prettyDate</code> renvoie un résultat, le innerHTML du lien est mis à jour avec ce résultat.</p>

<h2 id="rendre-le-code-testable">Rendre le code testable</h2>

<p>Le problème est que pour toute date antérieure à 31 jours, <code>prettyDate</code> renvoie juste <code>undefined</code> (implicitement, avec <code>return</code>), laissant ainsi tel quel le texte du lien. Donc, pour voir ce qui est censé se produire, on doit en dur une date actuelle :</p>

<div><div class="CodeRay">
  <div class="code"><pre><span class="tag">&lt;html&gt;</span>
<span class="tag">&lt;head&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">http-equiv</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/html; charset=UTF-8</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;title&gt;</span>Test unitaire sur date<span class="tag">&lt;/title&gt;</span>
    <span class="tag">&lt;script&gt;</span>
<span class="inline">    <span class="keyword">function</span> <span class="function">prettyDate</span>(now, time){
        <span class="keyword">var</span> date = <span class="keyword">new</span> Date(time || <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>),
            diff = (((<span class="keyword">new</span> Date(now)).getTime() - date.getTime()) / <span class="integer">1000</span>),
            day_diff = Math.floor(diff / <span class="integer">86400</span>);

        <span class="keyword">if</span> (isNaN(day_diff) || day_diff &lt; <span class="integer">0</span> || day_diff &gt;= <span class="integer">31</span>) {
            <span class="keyword">return</span>;
        }

        <span class="keyword">return</span> day_diff == <span class="integer">0</span> &amp;&amp; (
                diff &lt; <span class="integer">60</span> &amp;&amp; <span class="string"><span class="delimiter">&quot;</span><span class="content">à l'instant</span><span class="delimiter">&quot;</span></span> ||
                diff &lt; <span class="integer">120</span> &amp;&amp; <span class="string"><span class="delimiter">&quot;</span><span class="content">1 minute</span><span class="delimiter">&quot;</span></span> ||
                diff &lt; <span class="integer">3600</span> &amp;&amp; Math.floor( diff / <span class="integer">60</span> ) + <span class="string"><span class="delimiter">&quot;</span><span class="content"> minutes</span><span class="delimiter">&quot;</span></span> ||
                diff &lt; <span class="integer">7200</span> &amp;&amp; <span class="string"><span class="delimiter">&quot;</span><span class="content">1 heure</span><span class="delimiter">&quot;</span></span> ||
                diff &lt; <span class="integer">86400</span> &amp;&amp; Math.floor( diff / <span class="integer">3600</span> ) + <span class="string"><span class="delimiter">&quot;</span><span class="content"> heures</span><span class="delimiter">&quot;</span></span>) ||
            day_diff == <span class="integer">1</span> &amp;&amp; <span class="string"><span class="delimiter">&quot;</span><span class="content">Hier</span><span class="delimiter">&quot;</span></span> ||
            day_diff &lt; <span class="integer">7</span> &amp;&amp; day_diff + <span class="string"><span class="delimiter">&quot;</span><span class="content"> jours</span><span class="delimiter">&quot;</span></span> ||
            day_diff &lt; <span class="integer">31</span> &amp;&amp; Math.ceil( day_diff / <span class="integer">7</span> ) + <span class="string"><span class="delimiter">&quot;</span><span class="content"> semaines</span><span class="delimiter">&quot;</span></span>;
    }
    window.<span class="function">onload</span> = <span class="keyword">function</span>(){
        <span class="keyword">var</span> links = document.getElementsByTagName(<span class="string"><span class="delimiter">&quot;</span><span class="content">a</span><span class="delimiter">&quot;</span></span>);
        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="integer">0</span>; i &lt; links.length; i++) {
            <span class="keyword">if</span> (links[i].title) {
                <span class="keyword">var</span> date = prettyDate(<span class="string"><span class="delimiter">&quot;</span><span class="content">2008-01-28T22:25:00Z</span><span class="delimiter">&quot;</span></span>, links[i].title);
                <span class="keyword">if</span> (date) {
                    links[i].innerHTML = date;
                }
            }
        }
    };</span>
    <span class="tag">&lt;/script&gt;</span>
<span class="tag">&lt;/head&gt;</span>
<span class="tag">&lt;body&gt;</span>

<span class="tag">&lt;ul&gt;</span>
<span class="tag">&lt;li</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">entry</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">post57</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;p&gt;</span>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Curabitur dignissim quis libero eu lobortis.<span class="tag">&lt;/p&gt;</span>
    <span class="tag">&lt;small</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">extra</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        Posté il y a <span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/2008/01/blah/57/</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2008-01-28T21:24:17Z</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>January 28th, 2008<span class="tag">&lt;/a&gt;</span>
        par <span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/john/</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>John Resig<span class="tag">&lt;/a&gt;</span>
    <span class="tag">&lt;/small&gt;</span>
<span class="tag">&lt;/li&gt;</span>
<span class="comment">&lt;!-- more list items --&gt;</span>
<span class="tag">&lt;/ul&gt;</span>

<span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span>
</pre></div>
</div>
</div>

<p>Maintenant, les liens devraient avoir comme valeur : “à l’instant”, “il y a 2 heures”, “hier” etc… C’est un départ, mais ce n’est pas encore une unité testable. Donc, tout ce que nous pouvons faire, sans changer le code d’avantage, c’est tester les changements qui se sont produits dans DOM. Mais, même si cela fonctionne, le moindre changement dans le HTML pourrait faire échouer le test. Ce qui aurait quand même un très mauvais rapport coût/bénéfice pour un test comme celui-là.</p>

<h2 id="refactorisation-tape-0">Refactorisation, étape 0</h2>

<p>Au lieu de tester le HTML, refactorisons juste assez le code pour avoir quelque chose qui se test unitairement.</p>

<p>Pour cela, nous avons besoin d’effectuer deux changements : passer la date actuelle en paramètre à la fonction <code>prettyDate</code> en utilisant <code>new Date</code> au lieu de l’écrire en dur, puis déplacer la fonction dans un fichier à part afin que nous puissions inclure le code sur une page séparée et effectuer nos tests unitaires.</p>

<div><div class="CodeRay">
  <div class="code"><pre><span class="tag">&lt;html&gt;</span>
<span class="tag">&lt;head&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">http-equiv</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/html; charset=UTF-8</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;title&gt;</span>Refactored date examples<span class="tag">&lt;/title&gt;</span>
    <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">prettydate.js</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
    <span class="tag">&lt;script&gt;</span>
<span class="inline">    window.<span class="function">onload</span> = <span class="keyword">function</span>() {
        <span class="keyword">var</span> links = document.getElementsByTagName(<span class="string"><span class="delimiter">&quot;</span><span class="content">a</span><span class="delimiter">&quot;</span></span>);
        <span class="keyword">for</span> ( <span class="keyword">var</span> i = <span class="integer">0</span>; i &lt; links.length; i++ ) {
            <span class="keyword">if</span> (links[i].title) {
                <span class="keyword">var</span> date = prettyDate(<span class="string"><span class="delimiter">&quot;</span><span class="content">2008-01-28T22:25:00Z</span><span class="delimiter">&quot;</span></span>, links[i].title);
                <span class="keyword">if</span> (date) {
                    links[i].innerHTML = date;
                }
            }
        }
    };</span>
    <span class="tag">&lt;/script&gt;</span>
<span class="tag">&lt;/head&gt;</span>
<span class="tag">&lt;body&gt;</span>

<span class="tag">&lt;ul&gt;</span>
<span class="tag">&lt;li</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">entry</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">post57</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;p&gt;</span>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Curabitur dignissim quis libero eu lobortis.<span class="tag">&lt;/p&gt;</span>
    <span class="tag">&lt;small</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">extra</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        Posted <span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/2008/01/blah/57/</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2008-01-28T20:24:17Z</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>January 28th, 2008<span class="tag">&lt;/a&gt;</span>
        by <span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/john/</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>John Resig<span class="tag">&lt;/a&gt;</span>
    <span class="tag">&lt;/small&gt;</span>
<span class="tag">&lt;/li&gt;</span>
<span class="comment">&lt;!-- more list items --&gt;</span>
<span class="tag">&lt;/ul&gt;</span>

<span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span>
</pre></div>
</div>
</div>

<p>Et voici le contenu de <code>prettydate.js</code> :</p>

<div><div class="CodeRay">
  <div class="code"><pre><span class="keyword">function</span> <span class="function">prettyDate</span>(now, time){
    <span class="keyword">var</span> date = <span class="keyword">new</span> Date(time || <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>),
        diff = (((<span class="keyword">new</span> Date(now)).getTime() - date.getTime()) / <span class="integer">1000</span>),
        day_diff = Math.floor(diff / <span class="integer">86400</span>);

    <span class="keyword">if</span> (isNaN(day_diff) || day_diff &lt; <span class="integer">0</span> || day_diff &gt;= <span class="integer">31</span>) {
        <span class="keyword">return</span>;
    }

    <span class="keyword">return</span> day_diff == <span class="integer">0</span> &amp;&amp; (
            diff &lt; <span class="integer">60</span> &amp;&amp; <span class="string"><span class="delimiter">&quot;</span><span class="content">à l'instant</span><span class="delimiter">&quot;</span></span> ||
            diff &lt; <span class="integer">120</span> &amp;&amp; <span class="string"><span class="delimiter">&quot;</span><span class="content">1 minute</span><span class="delimiter">&quot;</span></span> ||
            diff &lt; <span class="integer">3600</span> &amp;&amp; Math.floor( diff / <span class="integer">60</span> ) + <span class="string"><span class="delimiter">&quot;</span><span class="content"> minutes</span><span class="delimiter">&quot;</span></span> ||
            diff &lt; <span class="integer">7200</span> &amp;&amp; <span class="string"><span class="delimiter">&quot;</span><span class="content">1 heure</span><span class="delimiter">&quot;</span></span> ||
            diff &lt; <span class="integer">86400</span> &amp;&amp; Math.floor( diff / <span class="integer">3600</span> ) + <span class="string"><span class="delimiter">&quot;</span><span class="content"> heures</span><span class="delimiter">&quot;</span></span>) ||
        day_diff == <span class="integer">1</span> &amp;&amp; <span class="string"><span class="delimiter">&quot;</span><span class="content">Hier</span><span class="delimiter">&quot;</span></span> ||
        day_diff &lt; <span class="integer">7</span> &amp;&amp; day_diff + <span class="string"><span class="delimiter">&quot;</span><span class="content"> jours</span><span class="delimiter">&quot;</span></span> ||
        day_diff &lt; <span class="integer">31</span> &amp;&amp; Math.ceil( day_diff / <span class="integer">7</span> ) + <span class="string"><span class="delimiter">&quot;</span><span class="content"> semaines</span><span class="delimiter">&quot;</span></span>;
}
</pre></div>
</div>
</div>

<p>Maintenant que nous avons quelque chose à tester, écrivons de vrais tests unitaires :</p>

<div><div class="CodeRay">
  <div class="code"><pre><span class="tag">&lt;html&gt;</span>
<span class="tag">&lt;head&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">http-equiv</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/html; charset=UTF-8</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;title&gt;</span>Refactored date examples<span class="tag">&lt;/title&gt;</span>
    <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">prettydate.js</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
    <span class="tag">&lt;script&gt;</span>
<span class="inline">    <span class="keyword">function</span> <span class="function">test</span>(then, expected) {
        results.total++;
        <span class="keyword">var</span> result = prettyDate(<span class="string"><span class="delimiter">&quot;</span><span class="content">2008-01-28T22:25:00</span><span class="delimiter">&quot;</span></span>, then);
        <span class="keyword">if</span> (result !== expected) {
            results.bad++;
            console.log(<span class="string"><span class="delimiter">&quot;</span><span class="content">Attendu </span><span class="delimiter">&quot;</span></span> + expected + <span class="string"><span class="delimiter">&quot;</span><span class="content">, mais obtenu </span><span class="delimiter">&quot;</span></span> + result);
        }
    }
    <span class="keyword">var</span> results = {
        <span class="key">total</span>: <span class="integer">0</span>,
        <span class="key">bad</span>: <span class="integer">0</span>
    };
    test(<span class="string"><span class="delimiter">&quot;</span><span class="content">2008-01-28T22:24:30</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">à l'instant</span><span class="delimiter">&quot;</span></span>);
    test(<span class="string"><span class="delimiter">&quot;</span><span class="content">2008-01-28T22:23:30</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">1 minute</span><span class="delimiter">&quot;</span></span>);
    test(<span class="string"><span class="delimiter">&quot;</span><span class="content">2008-01-28T21:23:30</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">1 heure</span><span class="delimiter">&quot;</span></span>);
    test(<span class="string"><span class="delimiter">&quot;</span><span class="content">2008-01-27T22:23:30</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hier</span><span class="delimiter">&quot;</span></span>);
    test(<span class="string"><span class="delimiter">&quot;</span><span class="content">2008-01-26T22:23:30</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">2 jours</span><span class="delimiter">&quot;</span></span>);
    test(<span class="string"><span class="delimiter">&quot;</span><span class="content">2007-01-26T22:23:30</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">undefined</span>);
    console.log(<span class="string"><span class="delimiter">&quot;</span><span class="content">De </span><span class="delimiter">&quot;</span></span> + results.total + <span class="string"><span class="delimiter">&quot;</span><span class="content"> tests, </span><span class="delimiter">&quot;</span></span> + results.bad + <span class="string"><span class="delimiter">&quot;</span><span class="content"> ont échoué, </span><span class="delimiter">&quot;</span></span>
        + (results.total - results.bad) + <span class="string"><span class="delimiter">&quot;</span><span class="content"> ont réussi.</span><span class="delimiter">&quot;</span></span>);</span>
    <span class="tag">&lt;/script&gt;</span>
<span class="tag">&lt;/head&gt;</span>
<span class="tag">&lt;body&gt;</span>
<span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span>
</pre></div>
</div>
</div>

<p>Nous avons un framework de test adapté, utilisant la console pour afficher les résultats. Il n’y a aucune dépendance au DOM, par conséquent, vous pouvez simplement l’exécuter dans un environnement JavaScript hors navigateur, tel que Node.js ou Rhino, en déplaçant le code de la balise script dans un fichier à part.</p>

<p>Si un test échoue, le résultat du test attendu ainsi que le résultat obtenu vont être affichés. Au final, un résumé du nombre de test en échec et réussis est aussi affiché.</p>

<p>Si tous les tests réussissent, comme ils le devraient, vous devriez voir la chose suivante dans la console :</p>

<div><div class="CodeRay">
  <div class="code"><pre>De 6 tests, 0 ont échoué, 6 ont réussi.
</pre></div>
</div>
</div>

<p>Pour voir ce qu’est une assertion <sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup> erronée, nous pouvons changer quelque chose afin que le test échoue :</p>

<div><div class="CodeRay">
  <div class="code"><pre>Attendu 2 jours, mais obtenu 2 jour.
De 6 tests, 1 ont échoué, 5 ont réussi.
</pre></div>
</div>
</div>

<p>Bien que cette approche adaptée est intéressant en POC <sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup> (on peut vraiment écrire un exécuteur de test en quelque lignes de code), il est bien plus pratique de d’utiliser un framework de test existant, qui fourni un meilleur affichage des résultats et plus d’infrastructure pour écrire et organiser les tests.</p>

<h2 id="qunit--un-outil-de-test-javascript">Qunit : un outil de test JavaScript</h2>

<p>Le choix d’un framework est principalement affaire de goût. Pour le reste de cet article, nous utiliseront QUnit (prononcé “q-unit”), car son style de description des tests est proche du framework de test que nous venons de créer.</p>

<div><div class="CodeRay">
  <div class="code"><pre><span class="tag">&lt;html&gt;</span>
<span class="tag">&lt;head&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">http-equiv</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/html; charset=UTF-8</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;title&gt;</span>Refactorisation date<span class="tag">&lt;/title&gt;</span>

    <span class="tag">&lt;link</span> <span class="attribute-name">rel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stylesheet</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//code.jquery.com/qunit/qunit-1.16.0.css</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//code.jquery.com/qunit/qunit-1.16.0.js</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
    <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">prettydate.js</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>

    <span class="tag">&lt;script&gt;</span>
<span class="inline">    test(<span class="string"><span class="delimiter">&quot;</span><span class="content">prettydate basics</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() {
        <span class="keyword">var</span> now = <span class="string"><span class="delimiter">&quot;</span><span class="content">2008/01/28 22:25:00</span><span class="delimiter">&quot;</span></span>;
        equal(prettyDate(now, <span class="string"><span class="delimiter">&quot;</span><span class="content">2008/01/28 22:24:30</span><span class="delimiter">&quot;</span></span>), <span class="string"><span class="delimiter">&quot;</span><span class="content">à l'instant</span><span class="delimiter">&quot;</span></span>);
        equal(prettyDate(now, <span class="string"><span class="delimiter">&quot;</span><span class="content">2008/01/28 22:23:30</span><span class="delimiter">&quot;</span></span>), <span class="string"><span class="delimiter">&quot;</span><span class="content">1 minute</span><span class="delimiter">&quot;</span></span>);
        equal(prettyDate(now, <span class="string"><span class="delimiter">&quot;</span><span class="content">2008/01/28 21:23:30</span><span class="delimiter">&quot;</span></span>), <span class="string"><span class="delimiter">&quot;</span><span class="content">1 heure</span><span class="delimiter">&quot;</span></span>);
        equal(prettyDate(now, <span class="string"><span class="delimiter">&quot;</span><span class="content">2008/01/27 22:23:30</span><span class="delimiter">&quot;</span></span>), <span class="string"><span class="delimiter">&quot;</span><span class="content">Hier</span><span class="delimiter">&quot;</span></span>);
        equal(prettyDate(now, <span class="string"><span class="delimiter">&quot;</span><span class="content">2008/01/26 22:23:30</span><span class="delimiter">&quot;</span></span>), <span class="string"><span class="delimiter">&quot;</span><span class="content">2 jours</span><span class="delimiter">&quot;</span></span>);
        equal(prettyDate(now, <span class="string"><span class="delimiter">&quot;</span><span class="content">2007/01/26 22:23:30</span><span class="delimiter">&quot;</span></span>), <span class="predefined-constant">undefined</span>);
    });</span>
    <span class="tag">&lt;/script&gt;</span>
<span class="tag">&lt;/head&gt;</span>
<span class="tag">&lt;body&gt;</span>
    <span class="tag">&lt;div</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">qunit</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/div&gt;</span>
<span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span>
</pre></div>
</div>
</div>

<p>Trois sections méritent que nous y portions attention. En dehors de l’habituel HTML boilerplate, nous avons trois fichiers inclus : deux fichiers pour QUnit (<code>qunit-1.16.0.css</code> et <code>qunit-1.16.0.js</code>) et notre script précédent <code>prettydate.js</code></p>

<p>Ensuite, il y a un autre bloc de script avec les tests à exécuter. La fonction de test <code>test()</code>, appelée une seule fois, reçoit une chaîne de caractère comme premier paramètre (qui donne un nom à la suite de tests) et une fonction comme deuxième paramètre (qui va effectivement exécuter le code pour ce test). Le code initialise une variable <code>now</code>, qui est réutilisée plus bas, puis apelle plusieurs fois la fonction <code>equal</code> avec variété de paramètres. La fonction <code>equal</code> est une assertion que QUnit fourni parmi tant d’autres. Le premier paramètre est le résultat d’un appel à la fonction prettyDate, avec maintenant la variable <code>now</code> en premier paramètre et une date en second. Le second paramètre est le resultat qui est attendu. Si les deux paramètres ont la même valeur à la fin, le test va passer, sinon il échoue.</p>

<p>Enfin, on peut voir dans le <code>body</code> quelques éléments spécifiques à QUnit (<code>&lt;div id="qunit"&gt;&lt;/div&gt;</code>). Ces éléments sont optionnels et permettent seulement d’afficher le résultat des tests.</p>

<p>Voici le résultat :</p>

<iframe style="width: 100%; height: 300px" src="http://jsfiddle.net/sdnthswp/embedded/result/light/"></iframe>

<p>Avec un test en échec, nous avons :</p>

<iframe style="width: 100%; height: 300px" src="http://jsfiddle.net/dw0meLxh/embedded/result/light/"></iframe>

<p>Puisque le test contient une assertion en échec, QUnit ne cache pas les résultats du test, et nous pouvons voir immédiatement ce qui s’est mal passé. Nous obtenons à la fois un affichage des résultats attendus et ceux obtenus, et un diff entre les deux. Ce qui est utile pour comparer des chaînes de caractères plus longue. Dans le cas présent, ce qui s’est mal passé est évident.</p>

<h2 id="refactorisation-tape-1">Refactorisation, étape 1</h2>

<p>Les assertions sont quelque peu incomplètes car nous ne testons pas la variante “n semaines”. Avant de l’ajouter, nous devons considérer une refonte du code. Aujourd’hui, on fait appel à <code>prettyDate</code> pour chaque assertion et on lui passe le paramètre <code>now</code>. Nous pourions facilement refactoriser cela en une fonction d’assertion personnalisée :</p>

<div><div class="CodeRay">
  <div class="code"><pre>test(<span class="string"><span class="delimiter">&quot;</span><span class="content">prettydate basics</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() {
    <span class="keyword">function</span> <span class="function">date</span>(then, expected) {
        equal(prettyDate(<span class="string"><span class="delimiter">&quot;</span><span class="content">2008/01/28 22:25:00</span><span class="delimiter">&quot;</span></span>, then), expected);
    }
    date(<span class="string"><span class="delimiter">&quot;</span><span class="content">2008/01/28 22:24:30</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">à l'instant</span><span class="delimiter">&quot;</span></span>);
    date(<span class="string"><span class="delimiter">&quot;</span><span class="content">2008/01/28 22:23:30</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">1 minute</span><span class="delimiter">&quot;</span></span>);
    date(<span class="string"><span class="delimiter">&quot;</span><span class="content">2008/01/28 21:23:30</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">1 heure</span><span class="delimiter">&quot;</span></span>);
    date(<span class="string"><span class="delimiter">&quot;</span><span class="content">2008/01/27 22:23:30</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hier</span><span class="delimiter">&quot;</span></span>);
    date(<span class="string"><span class="delimiter">&quot;</span><span class="content">2008/01/26 22:23:30</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">2 jours</span><span class="delimiter">&quot;</span></span>);
    date(<span class="string"><span class="delimiter">&quot;</span><span class="content">2007/01/26 22:23:30</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">undefined</span>);
});
</pre></div>
</div>
</div>

<p>Ici nous avons déplacé l’appel à <code>prettyDate</code> dans une fonction <code>date</code>, en insérant la variable <code>now</code> directement dans la fonction. Nous obtenons alors des données pertinentes pour chaque assertion, plus faciles à lire, tout en gardant un niveau d’abstraction assez évident.</p>

<h2 id="tester-la-manipulation-du-dom">Tester la manipulation du DOM</h2>

<p>Maintenant que la fonction <code>prettyDate</code> est suffisamment bien testée, retournons à notre exemple de départ. En plus de la fonction <code>prettyDate</code>, le code sélectionne quelques éléments du DOM et les mets à jour, tout cela au sein d’un événement <code>window.load</code>. En appliquant les mêmes principes qu’avant, nous devrions être capable de refactoriser ce code et de le tester. Ajouter à cela, nous présenterons un module pour ces deux fonctions qui permettra d’éviter la pollution de la scope globale et qui permettra aussi de donner un nom qui a plus de sens à ces deux fonctions.</p>

<div><div class="CodeRay">
  <div class="code"><pre><span class="tag">&lt;html&gt;</span>
<span class="tag">&lt;head&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">http-equiv</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/html; charset=UTF-8</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;title&gt;</span>Refactored date examples<span class="tag">&lt;/title&gt;</span>
    <span class="tag">&lt;link</span> <span class="attribute-name">rel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stylesheet</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//code.jquery.com/qunit/qunit-1.16.0.css</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//code.jquery.com/qunit/qunit-1.16.0.js</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
    <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">prettydate2.js</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
    <span class="tag">&lt;script&gt;</span>
<span class="inline">    test(<span class="string"><span class="delimiter">&quot;</span><span class="content">prettydate.format</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() {
        <span class="keyword">function</span> <span class="function">date</span>(then, expected) {
            equal(prettyDate.format(<span class="string"><span class="delimiter">&quot;</span><span class="content">2008/01/28 22:25:00</span><span class="delimiter">&quot;</span></span>, then), expected);
        }
        date(<span class="string"><span class="delimiter">&quot;</span><span class="content">2008/01/28 22:24:30</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">à l'instant</span><span class="delimiter">&quot;</span></span>);
        date(<span class="string"><span class="delimiter">&quot;</span><span class="content">2008/01/28 22:23:30</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">1 minute</span><span class="delimiter">&quot;</span></span>);
        date(<span class="string"><span class="delimiter">&quot;</span><span class="content">2008/01/28 21:23:30</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">1 heure</span><span class="delimiter">&quot;</span></span>);
        date(<span class="string"><span class="delimiter">&quot;</span><span class="content">2008/01/27 22:23:30</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hier</span><span class="delimiter">&quot;</span></span>);
        date(<span class="string"><span class="delimiter">&quot;</span><span class="content">2008/01/26 22:23:30</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">2 jours</span><span class="delimiter">&quot;</span></span>);
        date(<span class="string"><span class="delimiter">&quot;</span><span class="content">2007/01/26 22:23:30</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">undefined</span>);
    });

    test(<span class="string"><span class="delimiter">&quot;</span><span class="content">prettyDate.update</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() {
        <span class="keyword">var</span> links = document.getElementById(<span class="string"><span class="delimiter">&quot;</span><span class="content">qunit-fixture</span><span class="delimiter">&quot;</span></span>).getElementsByTagName(<span class="string"><span class="delimiter">&quot;</span><span class="content">a</span><span class="delimiter">&quot;</span></span>);
        equal(links[<span class="integer">0</span>].innerHTML, <span class="string"><span class="delimiter">&quot;</span><span class="content">January 28th, 2008</span><span class="delimiter">&quot;</span></span>);
        equal(links[<span class="integer">2</span>].innerHTML, <span class="string"><span class="delimiter">&quot;</span><span class="content">January 27th, 2008</span><span class="delimiter">&quot;</span></span>);
        prettyDate.update(<span class="string"><span class="delimiter">&quot;</span><span class="content">2008-01-28T22:25:00Z</span><span class="delimiter">&quot;</span></span>);
        equal(links[<span class="integer">0</span>].innerHTML, <span class="string"><span class="delimiter">&quot;</span><span class="content">2 heures</span><span class="delimiter">&quot;</span></span>);
        equal(links[<span class="integer">2</span>].innerHTML, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hier</span><span class="delimiter">&quot;</span></span>);
    });

    test(<span class="string"><span class="delimiter">&quot;</span><span class="content">prettyDate.update, un jour plus tard</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() {
        <span class="keyword">var</span> links = document.getElementById(<span class="string"><span class="delimiter">&quot;</span><span class="content">qunit-fixture</span><span class="delimiter">&quot;</span></span>).getElementsByTagName(<span class="string"><span class="delimiter">&quot;</span><span class="content">a</span><span class="delimiter">&quot;</span></span>);
        equal(links[<span class="integer">0</span>].innerHTML, <span class="string"><span class="delimiter">&quot;</span><span class="content">January 28th, 2008</span><span class="delimiter">&quot;</span></span>);
        equal(links[<span class="integer">2</span>].innerHTML, <span class="string"><span class="delimiter">&quot;</span><span class="content">January 27th, 2008</span><span class="delimiter">&quot;</span></span>);
        prettyDate.update(<span class="string"><span class="delimiter">&quot;</span><span class="content">2008-01-29T22:25:00Z</span><span class="delimiter">&quot;</span></span>);
        equal(links[<span class="integer">0</span>].innerHTML, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hier</span><span class="delimiter">&quot;</span></span>);
        equal(links[<span class="integer">2</span>].innerHTML, <span class="string"><span class="delimiter">&quot;</span><span class="content">2 jours</span><span class="delimiter">&quot;</span></span>);
    });</span>
    <span class="tag">&lt;/script&gt;</span>
<span class="tag">&lt;/head&gt;</span>
<span class="tag">&lt;body&gt;</span>
    <span class="tag">&lt;div</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">qunit</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/div&gt;</span>
    <span class="tag">&lt;div</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">qunit-fixture</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;ul&gt;</span>
            <span class="tag">&lt;li</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">entry</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">post57</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;p&gt;</span>Lorem ipsum<span class="tag">&lt;/p&gt;</span>
                <span class="tag">&lt;small</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">extra</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    Posté il y a <span class="tag">&lt;span</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">time</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/2008/01/blah/57/</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2008-01-28T20:24:17Z</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>January 28th, 2008<span class="tag">&lt;/a&gt;</span><span class="tag">&lt;/span&gt;</span>
                    par <span class="tag">&lt;span</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">author</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/john/</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>John Resig<span class="tag">&lt;/a&gt;</span><span class="tag">&lt;/span&gt;</span>
                <span class="tag">&lt;/small&gt;</span>
            <span class="tag">&lt;/li&gt;</span>
            <span class="tag">&lt;li</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">entry</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">post57</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;p&gt;</span>Lorem ipsum<span class="tag">&lt;/p&gt;</span>
                <span class="tag">&lt;small</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">extra</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    Posté il y a <span class="tag">&lt;span</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">time</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/2008/01/blah/57/</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2008-01-27T22:24:17Z</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>January 27th, 2008<span class="tag">&lt;/a&gt;</span><span class="tag">&lt;/span&gt;</span>
                    par <span class="tag">&lt;span</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">author</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/john/</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>John Resig<span class="tag">&lt;/a&gt;</span><span class="tag">&lt;/span&gt;</span>
                <span class="tag">&lt;/small&gt;</span>
            <span class="tag">&lt;/li&gt;</span>
        <span class="tag">&lt;/ul&gt;</span>
    <span class="tag">&lt;/div&gt;</span>
<span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span>
</pre></div>
</div>
</div>

<p>Voici le contenu de <code>prettydate2.js</code> :</p>

<div><div class="CodeRay">
  <div class="code"><pre><span class="keyword">var</span> prettyDate = {
    <span class="function">format</span>: <span class="keyword">function</span>(now, time){
        <span class="keyword">var</span> date = <span class="keyword">new</span> Date(time || <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>),
            diff = (((<span class="keyword">new</span> Date(now)).getTime() - date.getTime()) / <span class="integer">1000</span>),
            day_diff = Math.floor(diff / <span class="integer">86400</span>);

        <span class="keyword">if</span> (isNaN(day_diff) || day_diff &lt; <span class="integer">0</span> || day_diff &gt;= <span class="integer">31</span>) {
            <span class="keyword">return</span>;
        }

        <span class="keyword">return</span> day_diff === <span class="integer">0</span> &amp;&amp; (
                diff &lt; <span class="integer">60</span> &amp;&amp; <span class="string"><span class="delimiter">&quot;</span><span class="content">à l'instant</span><span class="delimiter">&quot;</span></span> ||
                diff &lt; <span class="integer">120</span> &amp;&amp; <span class="string"><span class="delimiter">&quot;</span><span class="content">1 minute</span><span class="delimiter">&quot;</span></span> ||
                diff &lt; <span class="integer">3600</span> &amp;&amp; Math.floor( diff / <span class="integer">60</span> ) + <span class="string"><span class="delimiter">&quot;</span><span class="content"> minutes</span><span class="delimiter">&quot;</span></span> ||
                diff &lt; <span class="integer">7200</span> &amp;&amp; <span class="string"><span class="delimiter">&quot;</span><span class="content">1 heure</span><span class="delimiter">&quot;</span></span> ||
                diff &lt; <span class="integer">86400</span> &amp;&amp; Math.floor( diff / <span class="integer">3600</span> ) + <span class="string"><span class="delimiter">&quot;</span><span class="content"> heures</span><span class="delimiter">&quot;</span></span>) ||
            day_diff === <span class="integer">1</span> &amp;&amp; <span class="string"><span class="delimiter">&quot;</span><span class="content">Hier</span><span class="delimiter">&quot;</span></span> ||
            day_diff &lt; <span class="integer">7</span> &amp;&amp; day_diff + <span class="string"><span class="delimiter">&quot;</span><span class="content"> jours</span><span class="delimiter">&quot;</span></span> ||
            day_diff &lt; <span class="integer">31</span> &amp;&amp; Math.ceil( day_diff / <span class="integer">7</span> ) + <span class="string"><span class="delimiter">&quot;</span><span class="content"> semaines</span><span class="delimiter">&quot;</span></span>;
    },

    <span class="function">update</span>: <span class="keyword">function</span>(now) {
        <span class="keyword">var</span> links = document.getElementsByTagName(<span class="string"><span class="delimiter">&quot;</span><span class="content">a</span><span class="delimiter">&quot;</span></span>);
        <span class="keyword">for</span> ( <span class="keyword">var</span> i = <span class="integer">0</span>; i &lt; links.length; i++ ) {
            <span class="keyword">if</span> (links[i].title) {
                <span class="keyword">var</span> date = prettyDate.format(now, links[i].title);
                <span class="keyword">if</span> (date) {
                    links[i].innerHTML = date;
                }
            }
        }
    }
};
</pre></div>
</div>
</div>

<p>La nouvelle fonction <code>prettyDate.update</code> est un extrait de l’exemple initial mais avec le paramètre <code>now</code> que nous passons à la fonction <code>prettyDate.format</code>. Le test de base de QUnit pour cette fonction commence par selectionner tous les éléments au sein de l’élément <code>#qunit-fixture</code>. <code>&lt;div id="qunit-fixture"&gt;&lt;/div&gt;</code> est un nouvel élément dans le <code>body</code>. Il contient un extrait du markup de notre exemple initial, suffisamment conséquent pour être éprouver par des tests. En le placant dans l’élément <code>#qunit-fixture</code>, nous n’avons pas à nous inquiéter d’éventuels changements de DOM suite à l’execution d’un test précédent, car QUNit va automatiquement ré-initialiser le markup après chaque test.</p>

<p>Regardons au premier test effectué pour <code>prettyDate.update</code>. Après avoir sélectionné les liens, deux assertions vérifient que ceux-ci ont bien leurs valeurs initiales. Après quoi, <code>prettyDate.update</code> est appelée, en lui passant une date donnée (identique à celle des tests précédents). Ensuite, deux assertions sont exécutées, vérifiant que le innerHTML de ces éléments ont la date au bon format “2 heures” et “Hier”.</p>

<h2 id="refactorisation-tape-2">Refactorisation, étape 2</h2>

<p>Le test suivant, <code>prettyDate.update, un jour plus tard</code> fait à peu près la même chose, hormis qu’il passe une date différente à <code>prettyDate.update</code> et ainsi attend un résultat différent pour les deux liens. Voyons si nous pouvons refactoriser ces tests pour supprimer le code dupliqué.</p>

<div><div class="CodeRay">
  <div class="code"><pre><span class="tag">&lt;html&gt;</span>
<span class="tag">&lt;head&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">http-equiv</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/html; charset=UTF-8</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;title&gt;</span>Refactored date examples<span class="tag">&lt;/title&gt;</span>
    <span class="tag">&lt;link</span> <span class="attribute-name">rel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stylesheet</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//code.jquery.com/qunit/qunit-1.16.0.css</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//code.jquery.com/qunit/qunit-1.16.0.js</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
    <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">prettydate2.js</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
    <span class="tag">&lt;script&gt;</span>
<span class="inline">    test(<span class="string"><span class="delimiter">&quot;</span><span class="content">prettydate.format</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() {
        <span class="keyword">function</span> <span class="function">date</span>(then, expected) {
            equal(prettyDate.format(<span class="string"><span class="delimiter">&quot;</span><span class="content">2008/01/28 22:25:00</span><span class="delimiter">&quot;</span></span>, then), expected);
        }
        date(<span class="string"><span class="delimiter">&quot;</span><span class="content">2008/01/28 22:24:30</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">à l'instant</span><span class="delimiter">&quot;</span></span>);
        date(<span class="string"><span class="delimiter">&quot;</span><span class="content">2008/01/28 22:23:30</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">1 minute</span><span class="delimiter">&quot;</span></span>);
        date(<span class="string"><span class="delimiter">&quot;</span><span class="content">2008/01/28 21:23:30</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">1 heure</span><span class="delimiter">&quot;</span></span>);
        date(<span class="string"><span class="delimiter">&quot;</span><span class="content">2008/01/27 22:23:30</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hier</span><span class="delimiter">&quot;</span></span>);
        date(<span class="string"><span class="delimiter">&quot;</span><span class="content">2008/01/26 22:23:30</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">2 jours</span><span class="delimiter">&quot;</span></span>);
        date(<span class="string"><span class="delimiter">&quot;</span><span class="content">2007/01/26 22:23:30</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">undefined</span>);
    });

    <span class="keyword">function</span> <span class="function">domtest</span>(name, now, first, second) {
        test(name, <span class="keyword">function</span>() {
            <span class="keyword">var</span> links = document.getElementById(<span class="string"><span class="delimiter">&quot;</span><span class="content">qunit-fixture</span><span class="delimiter">&quot;</span></span>).getElementsByTagName(<span class="string"><span class="delimiter">&quot;</span><span class="content">a</span><span class="delimiter">&quot;</span></span>);
            equal(links[<span class="integer">0</span>].innerHTML, <span class="string"><span class="delimiter">&quot;</span><span class="content">January 28th, 2008</span><span class="delimiter">&quot;</span></span>);
            equal(links[<span class="integer">2</span>].innerHTML, <span class="string"><span class="delimiter">&quot;</span><span class="content">January 27th, 2008</span><span class="delimiter">&quot;</span></span>);
            prettyDate.update(now);
            equal(links[<span class="integer">0</span>].innerHTML, first);
            equal(links[<span class="integer">2</span>].innerHTML, second);
        });
    }
    domtest(<span class="string"><span class="delimiter">&quot;</span><span class="content">prettyDate.update</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">2008/01/28 22:25:00</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">2 heures</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hier</span><span class="delimiter">&quot;</span></span>);
    domtest(<span class="string"><span class="delimiter">&quot;</span><span class="content">prettyDate.update, one day later</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">2008/01/29 22:25:00</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hier</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">2 jours</span><span class="delimiter">&quot;</span></span>);</span>
    <span class="tag">&lt;/script&gt;</span>
<span class="tag">&lt;/head&gt;</span>
<span class="tag">&lt;body&gt;</span>
    <span class="tag">&lt;div</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">qunit</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/div&gt;</span>
    <span class="tag">&lt;div</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">qunit-fixture</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;ul&gt;</span>
            <span class="tag">&lt;li</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">entry</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">post57</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;p&gt;</span>blah blah blah…<span class="tag">&lt;/p&gt;</span>
                <span class="tag">&lt;small</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">extra</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    Posted <span class="tag">&lt;span</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">time</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/2008/01/blah/57/</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2008/01/28 20:24:17</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>January 28th, 2008<span class="tag">&lt;/a&gt;</span><span class="tag">&lt;/span&gt;</span>
                    by <span class="tag">&lt;span</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">author</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/john/</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>John Resig<span class="tag">&lt;/a&gt;</span><span class="tag">&lt;/span&gt;</span>
                <span class="tag">&lt;/small&gt;</span>
            <span class="tag">&lt;/li&gt;</span>
            <span class="tag">&lt;li</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">entry</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">post57</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;p&gt;</span>blah blah blah…<span class="tag">&lt;/p&gt;</span>
                <span class="tag">&lt;small</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">extra</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    Posted <span class="tag">&lt;span</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">time</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/2008/01/blah/57/</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2008/01/27 22:24:17</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>January 27th, 2008<span class="tag">&lt;/a&gt;</span><span class="tag">&lt;/span&gt;</span>
                    by <span class="tag">&lt;span</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">author</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/john/</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>John Resig<span class="tag">&lt;/a&gt;</span><span class="tag">&lt;/span&gt;</span>
                <span class="tag">&lt;/small&gt;</span>
            <span class="tag">&lt;/li&gt;</span>
        <span class="tag">&lt;/ul&gt;</span>
    <span class="tag">&lt;/div&gt;</span>
<span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span>
</pre></div>
</div>
</div>

<p>Nous avons une nouvelle fonction <code>domtest</code>, qui encapsule la logique des deux tests précédents, avec comme paramètre le nom du test, la date et les deux chaînes de caractères attendues. Elle est donc appelée deux fois.</p>

<h2 id="retour-au-dpart">Retour au départ</h2>

<p>Ces choses en place, retournons à notre exemple de départ et regardons à quoi ça ressemble suite à la refactorisation.</p>

<div><div class="CodeRay">
  <div class="code"><pre><span class="tag">&lt;html&gt;</span>
<span class="tag">&lt;head&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">http-equiv</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/html; charset=UTF-8</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;title&gt;</span>Final date examples<span class="tag">&lt;/title&gt;</span>
    <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">prettydate2.js</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
    <span class="tag">&lt;script&gt;</span>
<span class="inline">    window.<span class="function">onload</span> = <span class="keyword">function</span>() {
        prettyDate.update(<span class="string"><span class="delimiter">&quot;</span><span class="content">2008-01-28T22:25:00Z</span><span class="delimiter">&quot;</span></span>);
    };</span>
    <span class="tag">&lt;/script&gt;</span>
<span class="tag">&lt;/head&gt;</span>
<span class="tag">&lt;body&gt;</span>

<span class="tag">&lt;ul&gt;</span>
<span class="tag">&lt;li</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">entry</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">post57</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;p&gt;</span>Lorem ipsum<span class="tag">&lt;/p&gt;</span>
    <span class="tag">&lt;small</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">extra</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        Posté il y a <span class="tag">&lt;span</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">time</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/2008/01/blah/57/</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2008-01-28T20:24:17Z</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;span&gt;</span>January 28th, 2008<span class="tag">&lt;/span&gt;</span><span class="tag">&lt;/a&gt;</span><span class="tag">&lt;/span&gt;</span>
        par <span class="tag">&lt;span</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">author</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/john/</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>John Resig<span class="tag">&lt;/a&gt;</span><span class="tag">&lt;/span&gt;</span>
    <span class="tag">&lt;/small&gt;</span>
<span class="tag">&lt;/li&gt;</span>
<span class="tag">&lt;li</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">entry</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">post57</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;p&gt;</span>Lorem ipsum<span class="tag">&lt;/p&gt;</span>
    <span class="tag">&lt;small</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">extra</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        Posté il y a <span class="tag">&lt;span</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">time</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/2008/01/blah/57/</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2008-01-27T22:24:17Z</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;span&gt;</span>January 27th, 2008<span class="tag">&lt;/span&gt;</span><span class="tag">&lt;/a&gt;</span><span class="tag">&lt;/span&gt;</span>
        par <span class="tag">&lt;span</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">author</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/john/</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>John Resig<span class="tag">&lt;/a&gt;</span><span class="tag">&lt;/span&gt;</span>
    <span class="tag">&lt;/small&gt;</span>
<span class="tag">&lt;/li&gt;</span>
<span class="tag">&lt;li</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">entry</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">post57</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;p&gt;</span>Lorem ipsum<span class="tag">&lt;/p&gt;</span>
    <span class="tag">&lt;small</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">extra</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        Posté il y a <span class="tag">&lt;span</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">time</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/2008/01/blah/57/</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2008-01-26T22:24:17Z</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;span&gt;</span>January 26th, 2008<span class="tag">&lt;/span&gt;</span><span class="tag">&lt;/a&gt;</span><span class="tag">&lt;/span&gt;</span>
        par <span class="tag">&lt;span</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">author</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/john/</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>John Resig<span class="tag">&lt;/a&gt;</span><span class="tag">&lt;/span&gt;</span>
    <span class="tag">&lt;/small&gt;</span>
<span class="tag">&lt;/li&gt;</span>
<span class="tag">&lt;li</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">entry</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">post57</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;p&gt;</span>Lorem ipsum<span class="tag">&lt;/p&gt;</span>
    <span class="tag">&lt;small</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">extra</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        Posté il y a <span class="tag">&lt;span</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">time</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/2008/01/blah/57/</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2008-01-25T22:24:17Z</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;span&gt;</span>January 25th, 2008<span class="tag">&lt;/span&gt;</span><span class="tag">&lt;/a&gt;</span><span class="tag">&lt;/span&gt;</span>
        par <span class="tag">&lt;span</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">author</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/john/</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>John Resig<span class="tag">&lt;/a&gt;</span><span class="tag">&lt;/span&gt;</span>
    <span class="tag">&lt;/small&gt;</span>
<span class="tag">&lt;/li&gt;</span>
<span class="tag">&lt;li</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">entry</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">post57</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;p&gt;</span>Lorem ipsum<span class="tag">&lt;/p&gt;</span>
    <span class="tag">&lt;small</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">extra</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        Posté il y a <span class="tag">&lt;span</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">time</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/2008/01/blah/57/</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2008-01-24T22:24:17Z</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;span&gt;</span>January 24th, 2008<span class="tag">&lt;/span&gt;</span><span class="tag">&lt;/a&gt;</span><span class="tag">&lt;/span&gt;</span>
        par <span class="tag">&lt;span</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">author</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/john/</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>John Resig<span class="tag">&lt;/a&gt;</span><span class="tag">&lt;/span&gt;</span>

    <span class="tag">&lt;/small&gt;</span>
<span class="tag">&lt;/li&gt;</span>
<span class="tag">&lt;li</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">entry</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">post57</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;p&gt;</span>Lorem ipsum<span class="tag">&lt;/p&gt;</span>
    <span class="tag">&lt;small</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">extra</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        Posté il y a <span class="tag">&lt;span</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">time</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/2008/01/blah/57/</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2008-01-14T22:24:17Z</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;span&gt;</span>January 14th, 2008<span class="tag">&lt;/span&gt;</span><span class="tag">&lt;/a&gt;</span><span class="tag">&lt;/span&gt;</span>
        par <span class="tag">&lt;span</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">author</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/john/</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>John Resig<span class="tag">&lt;/a&gt;</span><span class="tag">&lt;/span&gt;</span>
    <span class="tag">&lt;/small&gt;</span>
<span class="tag">&lt;/li&gt;</span>
<span class="tag">&lt;li</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">entry</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">post57</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;p&gt;</span>Lorem ipsum<span class="tag">&lt;/p&gt;</span>
    <span class="tag">&lt;small</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">extra</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        Posté il y a <span class="tag">&lt;span</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">time</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/2008/01/blah/57/</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2008-01-04T22:24:17Z</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;span&gt;</span>January 4th, 2008<span class="tag">&lt;/span&gt;</span><span class="tag">&lt;/a&gt;</span><span class="tag">&lt;/span&gt;</span>
        par <span class="tag">&lt;span</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">author</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/john/</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>John Resig<span class="tag">&lt;/a&gt;</span><span class="tag">&lt;/span&gt;</span>
    <span class="tag">&lt;/small&gt;</span>
<span class="tag">&lt;/li&gt;</span>
<span class="tag">&lt;li</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">entry</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">post57</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;p&gt;</span>Lorem ipsum<span class="tag">&lt;/p&gt;</span>
    <span class="tag">&lt;small</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">extra</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        Posté il y a <span class="tag">&lt;span</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">time</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/2008/01/blah/57/</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2007-12-15T22:24:17Z</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;span&gt;</span>December 15th, 2008<span class="tag">&lt;/span&gt;</span><span class="tag">&lt;/a&gt;</span><span class="tag">&lt;/span&gt;</span>
        par <span class="tag">&lt;span</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">author</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/john/</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>John Resig<span class="tag">&lt;/a&gt;</span><span class="tag">&lt;/span&gt;</span>
    <span class="tag">&lt;/small&gt;</span>
<span class="tag">&lt;/li&gt;</span>
<span class="tag">&lt;/ul&gt;</span>

<span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span>
</pre></div>
</div>
</div>

<p>Dans un exemple non statique, on supprimerait le paramètre de <code>prettyDate.update</code>. Globalement, la refactorisation est une énorme amélioration par rapport à l’exemple initiale. Grâce au module <code>prettyDate</code> que nous avons conçu, nos pouvons même y ajouter d’avantage de fonctionnalités sans polluer la scope globale.</p>

<h2 id="conclusion">Conclusion</h2>

<p>Le test JavaScript n’est pas seulement une affaire d’utiliser un exécuteur de test et écrire quelques tests; cela demande habituellement des changements structurel assez lourds quand il s’agit de code qui n’a été testé auparavant que manuellement. Nous avons suivi pas à pas un exemple de comment changer la structure du code d’un module existant pour exécuter des tests dessus, en utilisant un framework de test adapté. Puis nous avons remplacer ce framework par un autre qui possède plus de fonctionnalités et nous donne des retours visuels.
QUnit a beaucoup à offrir : test de code asynchrone tel que les <code>timeouts</code>, AJAX et les événements. Son exécuteur de test visuel nous aide à débugger le code en rendant facile la ré-exécution de tests spécifique et en fournissant des piles de traces pour les assertions qui ont échoués et les exceptions qui ont été attrapées. Pour aller plus loin, lisez le livre QUnit Cookbook.</p>

<p class="disclaimer">
Cet article est traduit de l&#8217;anglais à partir d&#8217;un article paru sur Smashing Magazine. J&#8217;ai donc tâché de rester fidèle à l&#8217;opinion de l&#8217;auteur. Par moments, les formulations ont du être tournée autrement afin de faciliter la lecture et la compréhension. Pour toute amélioration ou suggestion, n&#8217;hésitez pas à me contacter.<br />
</p>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>Un assertion est un énoncé considéré comme vrai, ou une affirmation.<a href="#fnref:1" rel="reference">&#8617;</a></p>
    </li>
    <li id="fn:2">
      <p>Proof-Of-Concept est un moyen d’éprouver une solution. En génie logiciel, généralement, on crée un petit programme pour éprouver qu’une idée est viable.<a href="#fnref:2" rel="reference">&#8617;</a></p>
    </li>
  </ol>
</div>
]]>
		</content>
	</entry>
	
	<entry>
		
			<title type="html"><![CDATA[Les pours et contres des frameworks JS]]></title>
		
		<link href="http://ptitgraig.github.io/blog/2015/01/05/les-pours-et-contres-des-frameworks-js/"/>
		<updated>2015-01-05T18:04:00+01:00</updated>
		<id>http://ptitgraig.github.io/blog/2015/01/05/les-pours-et-contres-des-frameworks-js</id>
		<content type="html">
			<![CDATA[
				
					<p></p>
				
			]]>
			<![CDATA[<p class="foreword">
Les pours et les contres des framework BackboneJS, AngularJS, EXTJS, EmberJS : pour t&#8217;aider à choisir dans cette jungle.
</p>
<!-- more -->

<h2 id="backbonejs">Backbone.js</h2>

<p>Pours :</p>

<ul>
  <li>
    <p>Simplicité - seulement 4 composants (Collection, Model, View, Router).</p>
  </li>
  <li>
    <p>Très grosse communauté et beaucoup de solutions sur Stackoverflow.</p>
  </li>
  <li>
    <p>Couche supérieures codés intelligemment comme Marionnette et Vertebae.</p>
  </li>
  <li>
    <p>L’architecture de ton application peut être personnalisée.</p>
  </li>
  <li>
    <p>Léger et mis à jour régulièrement. S’entend bien avec Underscore, jQuery/Zepto - des librairies très répendues.</p>
  </li>
  <li>
    <p>Fourni un niveau d’ abstraction suffisant avec prise de position raisonnable, permettant une adapation au plus proche des besoins du projet.</p>
  </li>
  <li>
    <p>Facile à prendre en main, offrant un bon tremplin pour les framework MV* Javascript.</p>
  </li>
  <li>
    <p>Compatibilité avec d’anciens navigateurs : IE7, 8 t même 6 (on osera tout de même pas aller jusque là).</p>
  </li>
</ul>

<p>Contres :</p>

<ul>
  <li>
    <p>La méthode extend copie le contenu de l’objet parent dans une nouvel objet. Bénéficier de l’héritage prototypal aurait été préférable.</p>
  </li>
  <li>
    <p>Manque de cas réel d’utilisation dans la documentation</p>
  </li>
  <li>
    <p>L’application TODO met le pied à l’étrier mais il y a encore beaucoup à apprendre après pour construire de grosses applications.</p>
  </li>
  <li>
    <p>La quantité de didacticiels sur comment faire les choses avec Backbone n’est pas cohérente et décrivrent des choses à différentes périodes de la vie de Backbone. Dand une équipe, des développeurs peuvent coder les choses à la façcon Backbone 0.3 alors que nous en sommes à une version antérieur à 1.</p>
  </li>
  <li>
    <p>Quelques reserves sur Backbone.sync qui pose contient dans son code des hypothèses concernant les communications typique HTTP déclenché par un clien. Ca ne s’adapte pas bien à la nature des WebSockets.</p>
  </li>
  <li>
    <p>Il n’y a pas, par défaut, de binding de view. Un re-rendu de la view alors qu’une simple propriété change semble être un peu du gâchi.</p>
  </li>
</ul>

<h2 id="angularjs">Angular.js</h2>

<p>Pours : </p>

<ul>
  <li>
    <p>Two-way data binding (système de liaison des données en deux sens) est extremement puissant. On pense donc d’avantage au model et à son état qu’à une série d’événements à déclencher. Le model est la seul source de vérité.</p>
  </li>
  <li>
    <p>Performance. AngularJS coûte peu en téléchargement. Son moteur de template utilise les noeuds du DOM au lieu de convertir des String en noeud. Ce qui doit améliorer les performances.</p>
  </li>
  <li>
    <p>Si tu cibles les navigateurs récents et que tu ne te soucis pas, ou peu, des anciens navigateurs, tu peux supprimer jQuery de tes dépendances.</p>
  </li>
  <li>
    <p>Intuitif, excellente documentation. Système de liaison des données ingénieux : Vue (view) HTML, portées (scope) imbriquées.</p>
  </li>
  <li>
    <p>Une extension Chrome, Batarang, qui fourni un accès en direct aux structures de données Angular.</p>
  </li>
  <li>
    <p>Minimisation du code de réutilisable (boilerplate code). Permet la réutilisation du code grâce à des composants. Etend la syntaxe HTML de sorte que de nombreuses fonctionnalités complexes finissent par êre aussi simple que la mise en place d’une directive (attribut) dans le code HTML. </p>
  </li>
  <li>
    <p>Très facilement testable grâce au système d’injection de dépendance.</p>
  </li>
  <li>
    <p>Ecrire une application complexe dans jQuery qui manipule le DOM : c’est déjà un petit exploit.</p>
  </li>
</ul>

<p>Contres :</p>

<ul>
  <li>
    <p>On ne peut pas, d’une manière simplement déclarative, spécifier une transition pour un changement d’UI qui vient d’un changement dans le model.</p>
  </li>
  <li>
    <p>Courbe d’apprentissage plus raide que Backbone, mais le gain est appréciable. </p>
  </li>
  <li>
    <p>La documentation pourrait être améliorée.</p>
  </li>
</ul>

<p>Largement inspiré de l’article de Smashing Magazine : 
<a href="http://www.smashingmagazine.com/2012/07/27/journey-through-the-javascript-mvc-jungle/">Journey Through The JavaScript MVC Jungle</a></p>
]]>
		</content>
	</entry>
	
	<entry>
		
			<title type="html"><![CDATA[S'y retrouver dans les outils de test Javascript]]></title>
		
		<link href="http://ptitgraig.github.io/blog/2015/01/05/sy-retrouver-dans-les-outils-de-test-javascript/"/>
		<updated>2015-01-05T14:21:00+01:00</updated>
		<id>http://ptitgraig.github.io/blog/2015/01/05/sy-retrouver-dans-les-outils-de-test-javascript</id>
		<content type="html">
			<![CDATA[
				
					<p></p>
				
			]]>
			<![CDATA[<p class="foreword">
Entre Jasmine, Sinon.js, Karma, QUnit tu ne sais plus où donner de la tête ? Voici un bref récapitulatif des outils pour tester du Javascript.
Cet article sera enrichi au fur et à mesure des mes connaissances sur les sujets.
</p>
<!-- more -->

<h2 id="dfinitions">Définitions</h2>

<h3 id="test-driven-development-tdd">Test-Driven Development (TDD)</h3>

<p>Le Test Driven Development (TDD) ou en français développement piloté par les tests est une technique de développement de logiciel qui préconise d’écrire les tests unitaires avant d’écrire le code source d’un logiciel <sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>.</p>

<p>Le cycle préconisé par TDD comporte 5 étapes :</p>

<ol>
  <li>écrire un premier test;</li>
  <li>vérifier qu’il échoue (car le code qu’il teste n’existe pas), afin de vérifier que le test est valide;</li>
  <li>écrire juste le code suffisant pour passer le test;</li>
  <li>vérifier que le test passe;</li>
  <li>puis refactoriser le code.</li>
</ol>

<p>Les intérêts :</p>

<ul>
  <li>facilite la production de code valide en toutes circonstances</li>
  <li>on utilise le programme avant même qu’il existe</li>
  <li>évite des erreurs de conceptions dues à la précipitation avant d’avoir défini les objectifs</li>
  <li>plus grande assurance lors du refactoring, tu sais que les tests ont fonctionné à un moment donné. Tu peux ainsi te permettre des changements radicaux dans le code</li>
</ul>

<p>Une chose importante est que les demandeurs doivent formaliser la manière dont ils testeront la fonctionnalité. C’est le travail du responsable applicatif de s’en assurer.</p>

<h3 id="behavior-driven-development-bdd">Behavior-Driven Development (BDD)</h3>

<p>Behavior Driven Development (ou BDD) est une méthode Agile qui encourage la collaboration entre les développeurs, les responsables qualités, les intervenants non-techniques et les entreprises participant à un projet de logiciel. Il a été conçu en 2003 par Dan North comme une réponse au Test Driven Development. <sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup></p>

<p>Le processus BDD met en avant le langage naturel et les interactions dans le processus de développement logiciel. Les développeurs utilisant le BDD utilisent leur langue maternelle en combinaison avec le langage du domaine Domaine Driven Design pour décrire l’objectif et le bénéfice de leur code. Cela permet aux développeurs de se concentrer sur les raisons pour lesquelles le code doit être créé, plutôt que les détails techniques, et minimise la traduction entre le langage technique dans lequel le code est écrit et le domaine de la langue parlée par les entreprises, les utilisateurs, les intervenants, la gestion de projet etc…</p>

<p>Dans la pratique :</p>

<ul>
  <li>on utilise des exemples pour décrire le comportement de la demande;</li>
  <li>on automatise ces exemples pour fournir rapidement des commentaires ou tests de non-regression;</li>
  <li>on utilise le mot ‘devrait’, ce qui contribue à clarifier la résponsabilité et permet la remise en cause de la fonctionnalité de l’application;</li>
  <li>on utilise ‘verifier que’, ce qui permet de faire la différence entre les résultats provenant du champ d’application du code et d’autres éléments du code;</li>
  <li>on utilise des ‘mocks’ (fausse fonction) en remplacant des modules de code qui ne sont pas encore écrits.</li>
</ul>

<h3 id="les-bibliotques-dnoncs-assertions-library">Les bibliotèques d’énoncés (assertions library)</h3>

<p>Une assertion est un énoncé considéré comme vrai. Les bibliothèques d’énoncés permettent de formuler les tests de manière compréhensible.
Quelques bibliothèques d’énoncés :
* should.js
* expect.js
* chai.js</p>

<h3 id="les-frameworks-de-test">Les frameworks de test</h3>

<p>Un framework de test engloble une ou plusieurs bibliothèques d’énoncés, permet de lancer des tests.</p>

<p>A compléter…</p>

<h2 id="les-outils">Les outils</h2>

<h3 id="jasmine">Jasmine</h3>

<p><img class="left" src="http://ptitgraig.github.io/images/test-jasmine.png" width="140" height="140" />
Jasmine est un <em>framework de test</em> JavaScript developpement orienté comportement (BDD). Il ne dépend d’aucun autre framework JavaScript.
Il ne requiert pas un DOM et possède une syntaxe propre et évidente, ce qui permet d’écrire facilement tes tests.</p>

<h3 id="mocha">Mocha</h3>

<p><img class="left" src="http://ptitgraig.github.io/images/test-mocha.png" width="140" height="140" />
Mocha est un <em>framework de test</em> JavaScript riche en fonctionnalités, basé sur Node.js et sur le navigateur, qui rend les tests asynchrones simple et agréable. Les tests Mocha se déroulent de manière séquentielle, ce qui permet d’établir un rapporte précis et flexible, tout en faisant concorder les exceptions non interceptées au bon cas de test.</p>

<h3 id="karma-anciennement-testacular">Karma (anciennement Testacular)</h3>

<p><img class="left" src="http://ptitgraig.github.io/images/test-karma.png" width="140" height="140" />
Karma est un <em>environnement de test</em>. Le but principal de Karma est d’offrir aux développeurs un environnement de test productif. Plutôt que de demander de mettre en place tout un tas de configurations, Karma te permet d’écire le code est d’obtenir un retour instantané de tes tests. La philosphie de Karma est : une retour rapide sur ton code, c’est ce qui te rend productif et créatif. C’est une opinion.</p>

<p>Karma est essentiellement un outil qui génère un serveur Web qui exécute le code source en se basant sur le code de test, et ce pour chaque navigateurs connectés. Les résultats de chaque test contre sur chaque navigateur sont calculées et affichées sur la ligne de commande de telle sorte que tu puisses voir quels sont les tests qui ont réussis et échoués, et ce sur chaque navigateur.
Tu peux tester le résulat sur un navigateur soit manuellement, en visitant l’URL écoutée par le serveur Karma (habituellement http://localhost:9876/), soit
automatiquement en configurant Karma de sorte qu’il sache quel navigateur démarrer quand Karma est exécuté.</p>

<p>Karma surveille aussi tous les fichiers listés dans le fichier de configuration. Dès qu’un fichier change, Karma déclenche les tests en envoyant un signal 
au serveur de test pour informer tout les navigayeurs connectés d’executer le code de test à nouveau. Chaque navigateur charge ensuite le code source dans une IFrame, exécute les tests, et rapporte les résultats au serveur.
Le serveur collecte les résultats de l’ensemble des navigateurs connectés et te les présente.</p>

<h3 id="intern">Intern</h3>

<p><img class="left" src="http://ptitgraig.github.io/images/test-intern.png" width="140" height="140" />
Intern est <em>une pile de test complète pour Javascript</em>, conçue pour t’aider à écrire et exécuter des cas de test, pour applications et biblothèques de scripts, cohérent et de haute qualité. Intern peut être utilisé pour tester n’importe quel code JavaScript. Ses capacités de test fonctionnel peuvent même être utilisé pour tester des applications mobile et web non JavaScript - si tu le veux vraiment.</p>

<h3 id="sinonjs">sinon.js</h3>

<p>Espions de test autonome et mocks pour JavaScript.
Aucune dépendances, fonctionne avec n’importe quel framework JavaScript.
Un espion de test est une fonction qui enregistre les paramètres, retourne la valeur de <code>this</code> et l’exception levée - si présente.
Un espion de test peut être une fonction anonyme ou peut être encapsuler dans une autre fonction.</p>

<div><div class="CodeRay">
  <div class="code"><pre><span class="string"><span class="delimiter">&quot;</span><span class="content">test should call subscribers on publish</span><span class="delimiter">&quot;</span></span>: <span class="keyword">function</span> () {
    <span class="keyword">var</span> callback = sinon.spy();
    PubSub.subscribe(<span class="string"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span>, callback);

    PubSub.publishSync(<span class="string"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span>);

    assertTrue(callback.called);
}
</pre></div>
</div>
</div>

<h3 id="shouldjs">should.js</h3>

<p>Enoncés (assertions) de style Behavior-Driven-Developemnt (BDD) pour Node.js, indépendant de tout framework de test.</p>

<div><div class="CodeRay">
  <div class="code"><pre><span class="keyword">var</span> should = require(<span class="string"><span class="delimiter">'</span><span class="content">should</span><span class="delimiter">'</span></span>);

<span class="keyword">var</span> user = {
    <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">tj</span><span class="delimiter">'</span></span>
  , <span class="key">pets</span>: [<span class="string"><span class="delimiter">'</span><span class="content">tobi</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">loki</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">jane</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">bandit</span><span class="delimiter">'</span></span>]
};

user.should.have.property(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">tj</span><span class="delimiter">'</span></span>);
user.should.have.property(<span class="string"><span class="delimiter">'</span><span class="content">pets</span><span class="delimiter">'</span></span>).<span class="keyword">with</span>.lengthOf(<span class="integer">4</span>);

<span class="comment">// Si l'objet a été créé avec Object.create(null)</span>
<span class="comment">// alors il n'hérite pas de `Object.prototype`, donc il n'aura pas une getter `.should`</span>
<span class="comment">// donc tu peux faire :</span>
should(user).have.property(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">tj</span><span class="delimiter">'</span></span>);

<span class="comment">// aussi, tu peux tester de cette manières les `null`</span>
should(<span class="predefined-constant">null</span>).not.be.ok;

someAsyncTask(foo, <span class="keyword">function</span>(err, result){
  should.not.exist(err);
  should.exist(result);
  result.bar.should.equal(foo);
});
</pre></div>
</div>
</div>

<h3 id="expectjs">expect.js</h3>

<p>Outils d’enoncés minimalistes de style BDD pour Node.JS et pour navigateurs, basé sur should.js</p>

<ul>
  <li>Cross-browser : fonctionne sur IE6+, Firefox, Safari, Chrome, Opera.</li>
  <li>Compatible avec tous les frameworks de test.</li>
  <li>Prête pour Node.JS (require(‘expect.js’)).</li>
  <li>Autonome. Global seule sans extensions de prototype ou brique (shims)</li>
</ul>

<div><div class="CodeRay">
  <div class="code"><pre>expect(window.r).to.be(<span class="predefined-constant">undefined</span>);
expect({ <span class="key">a</span>: <span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span> }).to.eql({ <span class="key">a</span>: <span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span> })
expect(<span class="integer">5</span>).to.be.a(<span class="string"><span class="delimiter">'</span><span class="content">number</span><span class="delimiter">'</span></span>);
expect([]).to.be.an(<span class="string"><span class="delimiter">'</span><span class="content">array</span><span class="delimiter">'</span></span>);
expect(window).not.to.be.an(Image);
</pre></div>
</div>
</div>

<h3 id="chaijs">chai.js</h3>

<p><img class="left" src="http://ptitgraig.github.io/images/test-chai.png" width="140" height="140" />
Chai est une bibliothèque d’énoncés BDD / TDD pour node.js et les navigateurs qui peut être couplé à n’importe quel framework de test JavaScript</p>

<h3 id="qunit">qUnit</h3>

<p>A venir.</p>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>http://fr.wikipedia.org/wiki/Test_Driven_Development<a href="#fnref:1" rel="reference">&#8617;</a></p>
    </li>
    <li id="fn:2">
      <p>http://fr.wikipedia.org/wiki/Behavior_Driven_Development<a href="#fnref:2" rel="reference">&#8617;</a></p>
    </li>
  </ol>
</div>
]]>
		</content>
	</entry>
	
	<entry>
		
			<title type="html"><![CDATA[La base de Spring MVC]]></title>
		
		<link href="http://ptitgraig.github.io/blog/2015/01/05/la-base-de-spring-mvc/"/>
		<updated>2015-01-05T12:49:00+01:00</updated>
		<id>http://ptitgraig.github.io/blog/2015/01/05/la-base-de-spring-mvc</id>
		<content type="html">
			<![CDATA[
				
					<p></p>
				
			]]>
			<![CDATA[<p class="foreword">
Fonctionnement basique du framework JAVA Spring MVC. Très bon pour la culture générale d&#8217;un développeur front.
</p>
<!-- more -->

<h2 id="fonctionnement">Fonctionnement</h2>

<p>Le framework Spring Web MVC est conçu autour d’une DispatcherServlet qui gère toutes les requêtes et réponses HTTP. Illustration ci-dessous :</p>

<p><img src="http://ptitgraig.github.io/images/spring_dispatcherservlet.png" /></p>

<ol>
  <li>
    <p>Après avoir reçu une requête HTTP, DispatchServlet consulte le HandlerMapping pour appeler le Controller approprié.</p>
  </li>
  <li>
    <p>Le Controller analyse la requête et apelle le la méthode du service appropriée, basé l’utilisation des méthodes POST ou GET. La méthode du service initialisera les données du model sur la base d’une logique business puis retournera ne nom de la vue à la DispatcherServlet</p>
  </li>
  <li>
    <p>La DispatcherServlet s’appuiera sur la ViewResolver pour choisir la bonne vue pour la requête</p>
  </li>
  <li>
    <p>Une fois que la vue est finalisée, la DispatcherServlet passe les données du model à la vue, cette dernière étant finalement affichée sur le navigateur.</p>
  </li>
</ol>

<p>Tous les composants mentionnés ci-dessus (HandlerMapping, Controller et ViewResolver) font partis du WebApplicationContext, lequel est une extention du ApplicationContext auquel on a ajouté quelques caractéristiques supplémentaires pour les applications web.</p>

<h2 id="spring-mvc-pour-faire-du-rest">Spring MVC pour faire du REST</h2>

]]>
		</content>
	</entry>
	
	<entry>
		
			<title type="html"><![CDATA[Comment bien calculer le poids d'un selecteur CSS]]></title>
		
		<link href="http://ptitgraig.github.io/blog/2014/06/18/comment-bien-calculer-le-poids-dun-selecteur-css/"/>
		<updated>2014-06-18T10:13:00+02:00</updated>
		<id>http://ptitgraig.github.io/blog/2014/06/18/comment-bien-calculer-le-poids-dun-selecteur-css</id>
		<content type="html">
			<![CDATA[
				
					<p></p>
				
			]]>
			<![CDATA[<p class="foreword">
Voici un article qui vous expliquera le poids des CSS. Cela est utile quand vous voulez surcharger un style, comprendre quel style s&#8217;applique à quel élément et pourquoi un style s&#8217;applique plutôt qu&#8217;un autre.
</p>
<!-- more -->

<p>Quand vous reprenez un projet existant, qui date déjà un peu, vous vous retrouvez souvent avec des déclarations CSS à rallonge et ne savait plus quoi s’applique à quoi.</p>

<div><div class="CodeRay">
  <div class="code"><pre><span class="class">.container</span> <span class="class">.info</span><span class="class">.test</span> <span class="class">.spanner</span> <span class="class">.wrapper</span> <span class="class">.block</span> <span class="tag">div</span><span class="class">.pictos</span> <span class="id">#jailanausee</span> { <span class="key">color</span> : <span class="color">#000</span>; }
</pre></div>
</div>
</div>

<p>Pour éviter je genre de massacre, il est d’une extrème importance de comprendre quel style va s’appliquer à quel élement, et dans quel ordre.
Prenons un exemple. Parmi ces quelques déclarations, laquelle va remporter le combat et s’appliquer au span. Quelle va être la couleur du texte du span : rouge, bleu, vert ou jaune ?</p>

<div><div class="CodeRay">
  <div class="code"><pre><span class="id">#idSpan</span> { <span class="key">color</span>: <span class="value">red</span>; }
<span class="tag">span</span><span class="class">.class-span</span> { <span class="key">color</span>: <span class="value">orange</span>; }
<span class="class">.bloc</span><span class="class">.info</span> <span class="tag">span</span> { <span class="key">color</span>: <span class="value">yellow</span>; }
<span class="class">.container</span> <span class="class">.bloc</span><span class="class">.info</span> <span class="class">.class-txt</span> <span class="tag">span</span><span class="class">.class-span</span> { <span class="key">color</span>: <span class="value">green</span>; }
<span class="tag">span</span> { <span class="key">color</span>: <span class="value">blue</span> <span class="important">!important</span> }
</pre></div>
</div>
</div>

<div><div class="CodeRay">
  <div class="code"><pre><span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">container</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">block info</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;span</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">class-span</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">idSpan</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">style</span>=<span class="string"><span class="delimiter">&quot;</span><span class="key">color</span>:<span class="value">purple</span>;<span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            je suis d'une certaine couleur
        <span class="tag">&lt;/span&gt;</span>
    <span class="tag">&lt;/div&gt;</span>
<span class="tag">&lt;/div&gt;</span>
</pre></div>
</div>
</div>

<p>La réponse est bleu ! <a href="http://jsfiddle.net/ptitgraig/L8CUS/2/">La preuve ici</a>.</p>

<p>Voici un court explicatif de l’ordre d’application des styles sur le span.</p>

<table>
	
		<td>
			!important
		</td>
		<td>
			attribut style (style=&#8221;&#8220;)
		</td>
		<td>
			nombre d&#8217;id (#)
		</td>
		<td>
			nombre de classes (.)
		</td>
		<td>
			nombre de balises
		</td>
	
	<tr>
		<td>
			gagne sur tous les autres style, même seul
		</td>
		<td>
			0 .. n
		</td>
		<td>
			0 .. n
		</td>
		<td>
			0 .. n
		</td>
		<td>
			0 .. n
		</td>
	</tr>
</table>

<p>Au final, vous vous trouvez avec un chiffre entre 0 et 19999. Reprenons notre exemple de départ. Sachant que l’attribut style s’applique toujours et annule les autres, nous allons nous en affranchir pour l’exemple.</p>

<table>
	<tr>
		<th>Déclaration CSS</th>
		<th>!important</th>
		<th>nombre d&#8217;id (#)</th>
		<th>nombre de classes (.)</th>
		<th>nombre de balises</th>
		<th>poids</th>
	</tr>
	<tr>
		<td>#idSpan</td>
		<td>0</td>
		<td>1</td>
		<td>0</td>
		<td>0</td>
		<td>0100</td>
	</tr>
	<tr>
		<td>span.class-span</td>
		<td>0</td>
		<td>0</td>
		<td>1</td>
		<td>1</td>
		<td>0011</td>
	</tr>
	<tr>
		<td>.bloc.info span</td>
		<td>0</td>
		<td>0</td>
		<td>2</td>
		<td>1</td>
		<td>0021</td>
	</tr>
	<tr>
		<td>.container .bloc.info .class-txt span.class-span</td>
		<td>0</td>
		<td>0</td>
		<td>5</td>
		<td>1</td>
		<td>0051</td>
	</tr>
	<tr>
		<td>span (avec !important)</td>
		<td>1</td>
		<td>0</td>
		<td>0</td>
		<td>1</td>
		<td>1001</td>
	</tr>
</table>

<p>Au final vous voyez l’ordre d’importance se déssiner :</p>

<ol>
  <li>span (avec !important) /* 1001 */</li>
  <li>#idSpan /* 0100 */</li>
  <li>.container .bloc.info .class-txt span.class-span /* 0051 */</li>
  <li>.bloc.info span /* 0021 */</li>
  <li>span.class-span /* 0011 */</li>
</ol>

]]>
		</content>
	</entry>
	
	<entry>
		
			<title type="html"><![CDATA[Memento Backbone.js]]></title>
		
		<link href="http://ptitgraig.github.io/blog/2014/02/05/memento-backbone-dot-js/"/>
		<updated>2014-02-05T17:26:00+01:00</updated>
		<id>http://ptitgraig.github.io/blog/2014/02/05/memento-backbone-dot-js</id>
		<content type="html">
			<![CDATA[
				
					<p></p>
				
			]]>
			<![CDATA[<p>Backbone est un framework javascript MVC qui permet de construire des applications de type Single-Page-Webapp.</p>

<p>En vérité il s’agit plutôt d’un framework MV* car le Controller n’existe pas vraiment dans Backbone.</p>

<p>Faisons un parrallèle entre un MVC classique et un MVC Backbone.
<!-- more --></p>

<h2 id="models">Models</h2>

<ul>
  <li>C’est là ou se fait la validation des données.</li>
  <li>Sont persistés soit par du localStorage ou bien par synchronisation avec une base de données.</li>
  <li>Plusieurs Views peuvent observer des changements sur un Model. Une View, en effet, regarde un Model et peut ainsi savoir quand un   Model a changé et afficher les infos à jour du Model.</li>
  <li>Un ensemble de Models est appelé une Collection. Dès qu’un Model dans cette Collection change, la View attachée à ce Model est notifiée.</li>
</ul>

<h2 id="controllers">Controllers</h2>

<ul>
  <li>N’existe pas. La View joue le rôle de Controller.</li>
  <li>Gérer les changements effectués dans la vue par l’utilisateur</li>
  <li>Mettre à jour le Model quand un utilisateur a terminé ses actions</li>
</ul>

<h2 id="views">Views</h2>

<ul>
  <li>C’est là que les utilisateurs cliquent et font mumuse.</li>
  <li>Donc c’est là qu’on lit / edite / supprime les données d’un Model.</li>
  <li>Il y a une fonction <code>render()</code> qui doit s’occuper d’afficher le contenu du Model (ça utilise le moteur de template de Underscore.js). On l’utilise en callback afin de notifier la View de potentiels changements sur le Model.</li>
  <li>Dans le code, on fait référence à la vue avec <code>this.el</code></li>
  <li>Quand un utilisateur clique dans la View, c’est normalement le Controller qui s’occupe du traitement a effectuer, mais comme on l’a vu, il n’y a pas de Controller dans Backbone. Les évenements sont gérés dans la View grâce à un objet <code>event : {}</code></li>
</ul>

<h2 id="pense-bte-pour-le-model">Pense-bête pour le Model</h2>

<h3 id="mthodes-native--backbone">Méthodes native à Backbone</h3>

<ul>
  <li><code>set</code> : pour changer ou initialiser un attribut du Model <code>myModel.set('toto', 'un valeur');</code></li>
  <li><code>get</code> : pour obtenir la valeur d’un attribut du Model <code>myModel.get('toto');</code></li>
  <li>
    <p><code>validate</code> : permet de valider le model :</p>

    <div><div class="CodeRay">
  <div class="code"><pre><span class="function">validate</span>: <span class="keyword">function</span>(attributes){
    <span class="keyword">if</span>(attributes.title === <span class="predefined-constant">undefined</span>){
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Remember to set a title for your todo.</span><span class="delimiter">&quot;</span></span>;
    }
},
</pre></div>
</div>
    </div>
  </li>
</ul>

<h3 id="ecoute-sur-un-model">Ecoute sur un Model</h3>

<ul>
  <li>
    <p>Ecouter si un Model change :</p>

    <div><div class="CodeRay">
  <div class="code"><pre><span class="local-variable">this</span>.on(<span class="string"><span class="delimiter">'</span><span class="content">change</span><span class="delimiter">'</span></span>, <span class="keyword">function</span>(){ 
    <span class="comment">//faire quelquechose</span>
});
</pre></div>
</div>
    </div>
  </li>
  <li>
    <p>Ecouter si l’attribut toto du model change   </p>

    <div><div class="CodeRay">
  <div class="code"><pre><span class="local-variable">this</span>.on(<span class="string"><span class="delimiter">'</span><span class="content">change:toto</span><span class="delimiter">'</span></span>)
</pre></div>
</div>
    </div>
  </li>
</ul>

<h2 id="pense-bte-pour-la-view">Pense-bête pour la View</h2>

<p>La méthode <code>render()</code> de la View peut être liée à la méthode <code>change()</code> du Model. Ainsi dès qu’il y a un changement dans le Model, la View refléte immédiatement ces changements.</p>

<h3 id="setelement">setElement()</h3>

<p>Colle un template HTML a une vue.</p>

<div><div class="CodeRay">
  <div class="code"><pre><span class="keyword">var</span> view = <span class="keyword">new</span> Backbone.View;
view.setElement(<span class="string"><span class="delimiter">'</span><span class="content">&lt;p&gt;&lt;a&gt;&lt;b&gt;test&lt;/b&gt;&lt;/a&gt;&lt;/p&gt;</span><span class="delimiter">'</span></span>);
view.el <span class="comment">// &lt;p&gt;&lt;a&gt;&lt;b&gt;test&lt;/b&gt;&lt;/a&gt;&lt;/p&gt;</span>
</pre></div>
</div>
</div>

<h3 id="render">render()</h3>

<p>A la fin de render() il est bien de faire <code>return this</code> car :</p>

<ul>
  <li>la View peut être réutiliser par des View parent</li>
  <li>Créer une liste d’éléments sans repeindre chacun individuellement, l’élément est déssiné une fois par le navigateur et la liste entière est remplie en données (sens peu claire)</li>
</ul>

<h2 id="pense-bte-collection">Pense-bête Collection</h2>

<h3 id="syntaxe">Syntaxe</h3>

<div><div class="CodeRay">
  <div class="code"><pre><span class="keyword">var</span> Todo = Backbone.Model.extend({});

<span class="keyword">var</span> TodosCollection = Backbone.Collection.extend({
  <span class="key">model</span>: Todo
});
</pre></div>
</div>
</div>

<h3 id="ajout-suppression-de-models">Ajout suppression de Models</h3>

<p>Une fois la Collection créée, on peut supprimer ou ajouter des Models à la Collection avec : <code>add()</code> et <code>remove()</code>. Ces 2 méthodes acceptent un ou plusieurs model en paramètre (sous forme de tableau [])</p>

<h3 id="retrouver-un-model">Retrouver un Model</h3>

<p><code>Collection.get(id)</code> avec id l’id du Model</p>

<div><div class="CodeRay">
  <div class="code"><pre><span class="keyword">var</span> myTodo = <span class="keyword">new</span> Todo({<span class="key">title</span>:<span class="string"><span class="delimiter">'</span><span class="content">Read the whole book</span><span class="delimiter">'</span></span>, <span class="key">id</span>: <span class="integer">2</span>});
<span class="keyword">var</span> todos = <span class="keyword">new</span> TodosCollection([myTodo]);
<span class="keyword">var</span> todo2 = todos.get(<span class="integer">2</span>);
</pre></div>
</div>
</div>

<p>Afin d’intentifier le Model récupéré on peut utiliser : <code>id</code> <code>cid</code> <code>idAttribute</code></p>

<p>Chaque Model a un <code>id</code> qui est unique (type Integer ou String)
<code>idAttribute</code> est l’attribut qui identifie le Model dans la database (<code>id</code> dans la base de donnée). Ca dit a Backbone quel champ de la base de donnée doit être remplir avec la propriété <code>id</code>. Exemple <code>userId</code> dans la base donnera un <code>userId</code> dans la définition du Model dans Backbone.</p>

<h3 id="ecouter-des-vnements">Ecouter des événements</h3>

<div><div class="CodeRay">
  <div class="code"><pre><span class="keyword">var</span> TodosCollection = <span class="keyword">new</span> Backbone.Collection();
TodosCollection.on(<span class="string"><span class="delimiter">&quot;</span><span class="content">change:title</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>(model) {
    console.log(<span class="string"><span class="delimiter">&quot;</span><span class="content">J'ai changer d'avis, je devrais </span><span class="delimiter">&quot;</span></span> + model.get(<span class="string"><span class="delimiter">'</span><span class="content">title</span><span class="delimiter">'</span></span>));
});
TodosCollection.add([
  { <span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">go to Jamaica.</span><span class="delimiter">'</span></span>, <span class="key">completed</span>: <span class="predefined-constant">false</span>, <span class="key">id</span>: <span class="integer">3</span> },
]);
<span class="keyword">var</span> myTodo = TodosCollection.get(<span class="integer">3</span>);
myTodo.set(<span class="string"><span class="delimiter">'</span><span class="content">title</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">aller nager</span><span class="delimiter">'</span></span>);
</pre></div>
</div>
</div>

<p>Va afficher : <code>J'ai changer d'avis, je devrais aller nager</code></p>

<ul>
  <li>
    <p>Ecouter si il y a du changement dans une collection (ajout suppression modification) :</p>

    <div><div class="CodeRay">
  <div class="code"><pre>TodosCollection.on(<span class="string"><span class="delimiter">&quot;</span><span class="content">add</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>(model) {
  console.log(<span class="string"><span class="delimiter">&quot;</span><span class="content">Ajouté </span><span class="delimiter">&quot;</span></span> + model.get(<span class="string"><span class="delimiter">'</span><span class="content">title</span><span class="delimiter">'</span></span>));
});
TodosCollection.on(<span class="string"><span class="delimiter">&quot;</span><span class="content">remove</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>(model) {
  console.log(<span class="string"><span class="delimiter">&quot;</span><span class="content">Supprimé </span><span class="delimiter">&quot;</span></span> + model.get(<span class="string"><span class="delimiter">'</span><span class="content">title</span><span class="delimiter">'</span></span>));
});

TodosCollection.on(<span class="string"><span class="delimiter">&quot;</span><span class="content">change:completed</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>(model) {
  console.log(<span class="string"><span class="delimiter">&quot;</span><span class="content">Changement de l'attribute completed </span><span class="delimiter">&quot;</span></span> + model.get(<span class="string"><span class="delimiter">'</span><span class="content">title</span><span class="delimiter">'</span></span>));
});
TodosCollection.set([
    { <span class="key">id</span>: <span class="integer">1</span>, <span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">go to Jamaica.</span><span class="delimiter">'</span></span>, <span class="key">completed</span>: <span class="predefined-constant">true</span> },
    { <span class="key">id</span>: <span class="integer">2</span>, <span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">go to China.</span><span class="delimiter">'</span></span>, <span class="key">completed</span>: <span class="predefined-constant">false</span> },
    { <span class="key">id</span>: <span class="integer">4</span>, <span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">go to Disney World.</span><span class="delimiter">'</span></span>, <span class="key">completed</span>: <span class="predefined-constant">false</span> }
]);
</pre></div>
</div>
    </div>
  </li>
  <li>
    <p>Vider une Collection :</p>

    <div><div class="CodeRay">
  <div class="code"><pre>myCollection.reset()
</pre></div>
</div>
    </div>
  </li>
  <li>
    <p>Ecouter le vidage d’une Collection : </p>

    <div><div class="CodeRay">
  <div class="code"><pre>myCollection.on(<span class="string"><span class="delimiter">&quot;</span><span class="content">reset</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>)
</pre></div>
</div>
    </div>
  </li>
  <li>
    <p>Attention : faire un <code>set()</code> d’une Collection peut provoquer des <code>remove()</code> ou <code>add()</code> en fonction de ce qui est setté</p>
  </li>
</ul>

<h3 id="fonctionnalits-hrites-dunderscore">Fonctionnalités héritées d’Underscore</h3>

<ul>
  <li><code>forEach</code></li>
  <li><code>sortBy</code></li>
  <li><code>map</code></li>
  <li>
    <p><code>min/max</code> :</p>

    <div><div class="CodeRay">
  <div class="code"><pre>Todos.max(<span class="keyword">function</span>(model){
  <span class="keyword">return</span> model.id;
}).id;
</pre></div>
</div>
    </div>
  </li>
  <li>
    <p><code>pluck</code></p>
  </li>
  <li>
    <p><code>chain</code> permet de chainer l’appel de fonction sur une Collection</p>

    <div><div class="CodeRay">
  <div class="code"><pre><span class="keyword">var</span> collection = <span class="keyword">new</span> Backbone.Collection([
  { <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Tim</span><span class="delimiter">'</span></span>, <span class="key">age</span>: <span class="integer">5</span> },
  { <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Ida</span><span class="delimiter">'</span></span>, <span class="key">age</span>: <span class="integer">26</span> },
  { <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Rob</span><span class="delimiter">'</span></span>, <span class="key">age</span>: <span class="integer">55</span> }
]);

<span class="keyword">var</span> filteredNames = collection.chain() <span class="comment">// start chain, returns wrapper around collection's models</span>
  .filter(<span class="keyword">function</span>(item) { <span class="keyword">return</span> item.get(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>) &gt; <span class="integer">10</span>; }) <span class="comment">// returns wrapped array excluding Tim</span>
  .map(<span class="keyword">function</span>(item) { <span class="keyword">return</span> item.get(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>); }) <span class="comment">// returns wrapped array containing remaining names</span>
  .value(); <span class="comment">// terminates the chain and returns the resulting array</span>

console.log(filteredNames); <span class="comment">// logs: ['Ida', 'Rob']</span>
</pre></div>
</div>
    </div>
  </li>
</ul>

<h2 id="persistence-restful">Persistence RESTful</h2>

<h3 id="rcuprr-un-model-du-serveur">Récupérér un Model du serveur</h3>

<p><code>Collection.fetch()</code> retrouve un ensemble de Models du server sous la form d’un tableau JSON en envoyant une requête HTTP GET vers l’URL spécifié par la propriété <code>url</code> de la Collection. Quand les données sont récupérées, la fonction <code>set()</code> va être exécuté pour mettre à jour la Collection.</p>

<h3 id="sauvegarder-un-model-sur-le-serveur">Sauvegarder un Model sur le serveur</h3>

<p>On utilise la méthode <code>save()</code> du Model que l’on veut sauvegarder.
- Quand <code>save()</code> est appelé sur un Model qui a été récupérer du serveur avec la méthode <code>fetch()</code>, un requête HTTP PUT est envoyée.
- Si le Model est une nouvelle instance, une requête HTTP POST est envoyé à l’URL de la Collection.</p>

<h3 id="supprimer-un-model-du-serveur">Supprimer un Model du serveur</h3>

<p>Avec <code>destroy()</code> : envoie une requête HTTP DELETE</p>

<h3 id="options">Options</h3>

<p>Il est possible de passer seulement les choses que l’on veut mettre à jour dans un Model et pas forcememnt tout le Model (requête HTTP PATCH). Par exemple :</p>

<div><div class="CodeRay">
  <div class="code"><pre><span class="comment">// Sauvegarde partielle avec PATCH</span>
model.clear().set({<span class="key">id</span>: <span class="integer">1</span>, <span class="key">a</span>: <span class="integer">1</span>, <span class="key">b</span>: <span class="integer">2</span>, <span class="key">c</span>: <span class="integer">3</span>, <span class="key">d</span>: <span class="integer">4</span>});
model.save();
model.save({<span class="key">b</span>: <span class="integer">2</span>, <span class="key">d</span>: <span class="integer">4</span>}, {<span class="key">patch</span>: <span class="predefined-constant">true</span>});
console.log(<span class="local-variable">this</span>.syncArgs.method);
<span class="comment">// 'patch'</span>
</pre></div>
</div>
</div>

<h2 id="events">Events</h2>

<h3 id="on-off-trigger">on() off() trigger()</h3>

<p><code>Backbone.Events</code> peut donner à un objet la capacité de lié et déclencher des événements personnalisés.</p>

<p><code>on()</code> lie une fonction callback à un objet. Le callback est appelé à chaque fois que l’événement est déclenché.</p>

<div><div class="CodeRay">
  <div class="code"><pre><span class="keyword">var</span> myObject = {};

<span class="comment">// Mixin</span>
_.extend(myObject, Backbone.Events);

<span class="comment">// Ajouter un événement personnalisé</span>
myObject.on(<span class="string"><span class="delimiter">'</span><span class="content">dance</span><span class="delimiter">'</span></span>, <span class="keyword">function</span>(msg){
  console.log(<span class="string"><span class="delimiter">'</span><span class="content">Déclenchement de </span><span class="delimiter">'</span></span> + msg);
});

<span class="comment">// Trigger the custom event</span>
myObject.trigger(<span class="string"><span class="delimiter">'</span><span class="content">dance</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">our event</span><span class="delimiter">'</span></span>);
</pre></div>
</div>
</div>

<p><code>off()</code> supprime toutes les fonctions de callback sur un objet</p>

<div><div class="CodeRay">
  <div class="code"><pre><span class="comment">// Removes event bound to the object</span>
myObject.off(<span class="string"><span class="delimiter">&quot;</span><span class="content">dance:tap</span><span class="delimiter">&quot;</span></span>);
</pre></div>
</div>
</div>

<p>Pour supprimer une callback en particulier :</p>

<div><div class="CodeRay">
  <div class="code"><pre><span class="keyword">var</span> ourObject = {};

<span class="comment">// Mixin</span>
_.extend(ourObject, Backbone.Events);

<span class="keyword">function</span> <span class="function">dancing</span> (msg) { console.log(<span class="string"><span class="delimiter">&quot;</span><span class="content">We are dancing. </span><span class="delimiter">&quot;</span></span> + msg); }
<span class="keyword">function</span> <span class="function">jumping</span> (msg) { console.log(<span class="string"><span class="delimiter">&quot;</span><span class="content">We are jumping. </span><span class="delimiter">&quot;</span></span> + msg); }

<span class="comment">// Add two listeners to the same event</span>
ourObject.on(<span class="string"><span class="delimiter">&quot;</span><span class="content">move</span><span class="delimiter">&quot;</span></span>, dancing);
ourObject.on(<span class="string"><span class="delimiter">&quot;</span><span class="content">move</span><span class="delimiter">&quot;</span></span>, jumping);

<span class="comment">// Trigger the events. Both listeners are called.</span>
ourObject.trigger(<span class="string"><span class="delimiter">&quot;</span><span class="content">move</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Yeah!</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// Removes specified listener</span>
ourObject.off(<span class="string"><span class="delimiter">&quot;</span><span class="content">move</span><span class="delimiter">&quot;</span></span>, dancing);

<span class="comment">// Trigger the events again. One listener left.</span>
ourObject.trigger(<span class="string"><span class="delimiter">&quot;</span><span class="content">move</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Yeah, jump, jump!</span><span class="delimiter">&quot;</span></span>);
</pre></div>
</div>
</div>

<p><code>trigger()</code> peut passer plusieurs arguments à une fonction callback</p>

<div><div class="CodeRay">
  <div class="code"><pre><span class="keyword">var</span> ourObject = {};

<span class="comment">// Mixin</span>
_.extend(ourObject, Backbone.Events);

<span class="keyword">function</span> <span class="function">doAction</span> (action, duration) {
  console.log(<span class="string"><span class="delimiter">&quot;</span><span class="content">We are </span><span class="delimiter">&quot;</span></span> + action + <span class="string"><span class="delimiter">'</span><span class="content"> for </span><span class="delimiter">'</span></span> + duration ); 
}

<span class="comment">// Add event listeners</span>
ourObject.on(<span class="string"><span class="delimiter">&quot;</span><span class="content">dance</span><span class="delimiter">&quot;</span></span>, doAction);
ourObject.on(<span class="string"><span class="delimiter">&quot;</span><span class="content">jump</span><span class="delimiter">&quot;</span></span>, doAction);
ourObject.on(<span class="string"><span class="delimiter">&quot;</span><span class="content">skip</span><span class="delimiter">&quot;</span></span>, doAction);

<span class="comment">// Passing multiple arguments to single event</span>
ourObject.trigger(<span class="string"><span class="delimiter">&quot;</span><span class="content">dance</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">dancing</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">5 minutes</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// Passing multiple arguments to multiple events</span>
ourObject.trigger(<span class="string"><span class="delimiter">&quot;</span><span class="content">dance jump skip</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">on fire</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">15 minutes</span><span class="delimiter">&quot;</span></span>);
</pre></div>
</div>
</div>

<p><code>listenTo()</code> et <code>stopListening()</code> permet à un objet {d’écouter/ arrêter d’écouter} les événements sur un autre objet.</p>

<p><em>Chaque fois qu’on fait <code>on()</code> sur un objet on doit faire aussi <code>off()</code></em>, sinon quand on supprimer un Model il va rester en mémoire. <code>View.remove()</code> fait un appel à <code>stopListening()</code> afin de s’assurer que tous les écouteurs sont déliées.</p>

<h3 id="events-et-views">Events et Views</h3>

<p>2 types d’événements peuvent être lié à une View :</p>

<ul>
  <li>événements DOM (via <code>jQuery.on()</code> this va faire référence à l’objet DOM)</li>
  <li>événements déclenché via une API Event (via la propriété <code>events{}</code>,  <code>this</code> fait référence à la View)</li>
</ul>

<h2 id="routers">Routers</h2>

<p>Connecte des URLs à des parties de l’application. Nécessaire si tu veux que certaines parties de ton application soient : mise dans les favoris, partageable, si tu veux pouvoir faire un Back avec le bouton back du navigateur.</p>

<div><div class="CodeRay">
  <div class="code"><pre><span class="keyword">var</span> TodoRouter = Backbone.Router.extend({
    <span class="key">routes</span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">search/:query/p:page</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">searchTodos</span><span class="delimiter">&quot;</span></span>
        <span class="comment">// http://example.com/#search/job/p1</span>
    }
});
<span class="keyword">var</span> myTodoRouter = <span class="keyword">new</span> TodoRouter();
</pre></div>
</div>
</div>

<p><code>Backbone.history.start();</code> dit à Backbone qu’il fait observer tout changement de hash dans l’URL (d’où le /# hyper vitale)</p>

]]>
		</content>
	</entry>
	
	<entry>
		
			<title type="html"><![CDATA[Les fondamentaux de Marionette]]></title>
		
		<link href="http://ptitgraig.github.io/blog/2014/01/30/4-les-fondamentaux-de-marionette/"/>
		<updated>2014-01-30T10:45:00+01:00</updated>
		<id>http://ptitgraig.github.io/blog/2014/01/30/4-les-fondamentaux-de-marionette</id>
		<content type="html">
			<![CDATA[
				
					<p></p>
				
			]]>
			<![CDATA[<p class="foreword">
Tu as choisi de développer ta dernière super application web avec Backbone. 
Marionette.js simplifie ton application en te fournissant du code robuste et en adressant certaines lacunes de Backbone.
Voici les fondamentaux de Marionette pour te mettre le pied à l&#8217;étrier.
</p>
<!-- more -->

<h2 id="pourquoi-marionette-">Pourquoi Marionette ?</h2>

<p>Pourquoi utiliser Marionette ? Il est en effet tout à fait possible d’écrire ton application Backbone sans Marionette.
Cependant je t’invite à regarder d’un peu plus près la distribution du code dans Backbone afin de voir là où il peut exister de potentielles lacunes.</p>

<p>Distribution du code dans Backbone :</p>

<ul>
  <li>Données : <code>Model</code> (53% du code)</li>
  <li>Présentation : <code>Views</code> (9% du code)</li>
  <li>Architecture : le reste qui fait la jointure entre données et présentation (<code>Routes</code> etc…) (38% du code).</li>
</ul>

<p>A la vue de ces données, tu remarqueras que seulement 9% du code de Backbone est dédiée à la gestion des Views. C’est peu, mais caractéristique de Backbone.</p>

<p>Je t’invite maintenant à regarder la distribution du code dans Marionette.</p>

<ul>
  <li>Data : <code>Model</code> (0% du code)</li>
  <li>Présentation : <code>Views</code> (67% du code)</li>
  <li>Architecture : le reste (33% du code)</li>
</ul>

<p>Tu remarques que 67% du code de Marionette est dédiée à la presentation. Ainsi, Marionette a pour principale objectif de combler le manque de gestion des Vues dans Backbone.</p>

<h2 id="problme-avec-les-views-dans-backbone">Problème avec les Views dans Backbone</h2>

<p>Les problèmes concernant les Views les plus fréquents sont souvent les suivants :</p>

<ul>
  <li>la gestion des vues imbriquées</li>
  <li>la collection de vues</li>
  <li>les évènements des vues</li>
</ul>

<p>Que propose donc Marionette ?</p>

<h2 id="marionette-render">Marionette Render</h2>

<p>Marionette vient avec une nouvelle implémentation de <code>Render</code>.
Voici les différentes fonctionnalités du <code>Render</code> de Marionette.</p>

<ol>
  <li>
    <p>Marionette Render sérialise model et collection (transforme en JSON)</p>

    <div><div class="CodeRay">
  <div class="code"><pre>person.get(<span class="string"><span class="delimiter">'</span><span class="content">prenom</span><span class="delimiter">'</span></span>);
<span class="comment">// &gt;&gt; 'Grégory'</span>

view.serializeData(person)
<span class="comment">// {</span>
<span class="comment">//     prenom: 'Grégory'</span>
<span class="comment">//     nom: 'PELLETEY'</span>
<span class="comment">// }</span>
</pre></div>
</div>
    </div>
  </li>
  <li>
    <p>Marionette Render te permet d’ajouter des datas à la vue avec le méthode <code>templateHelpers</code>. Comment ça marche :</p>

    <div><div class="CodeRay">
  <div class="code"><pre>MyView.prototype.<span class="function">templateHelpers</span> : <span class="keyword">function</span>(){
    <span class="keyword">return</span> : <span class="local-variable">this</span>.model.get(<span class="string"><span class="delimiter">'</span><span class="content">prenom</span><span class="delimiter">'</span></span>) + 
             <span class="local-variable">this</span>.model.get(<span class="string"><span class="delimiter">'</span><span class="content">nom</span><span class="delimiter">'</span></span>)
}
<span class="comment">// {</span>
<span class="comment">//    prenom : 'Grégory'</span>
<span class="comment">//    nom : 'PELLETEY'</span>
<span class="comment">// }  </span>
</pre></div>
</div>
    </div>
  </li>
  <li>
    <p>Compile le template si besoin</p>
  </li>
  <li>
    <p>Render le template</p>
  </li>
  <li>
    <p>Place le HTML dans l’élèment de la Vue.</p>
  </li>
  <li>
    <p>Retourne une instance de la Vue.</p>
  </li>
</ol>

<h2 id="marionette-events">Marionette Events</h2>

<p>Une pattern courante dans Backbone est un Vue qui veut écouter les évènements qui lui sont attachés.
A chaque fois que je <code>render</code> la Vue <code>MyView</code>, un appel à la méthode <code>onRender</code> est fait.</p>

<div><div class="CodeRay">
  <div class="code"><pre><span class="keyword">var</span> MyView = Backbone.View.extend({
    <span class="function">initialize</span>: <span class="keyword">function</span>() {
        <span class="local-variable">this</span>.on(<span class="string"><span class="delimiter">'</span><span class="content">render</span><span class="delimiter">'</span></span>, <span class="local-variable">this</span>.onRender, <span class="local-variable">this</span>); 
    },
    <span class="function">onRender</span>: <span class="keyword">function</span>() {
        console.log(<span class="string"><span class="delimiter">'</span><span class="content">rendered!!</span><span class="delimiter">'</span></span>);
    }
});

<span class="comment">// j'appele la méthode render de la vue myView, le callback est déclenché</span>
myView.trigger(<span class="string"><span class="delimiter">'</span><span class="content">render</span><span class="delimiter">'</span></span>); 
</pre></div>
</div>
</div>

<p>Avec Marionette, tu n’as plus à enregistrer l’évènement :</p>

<div><div class="CodeRay">
  <div class="code"><pre><span class="keyword">var</span> MyView = Backbone.View.extend({
    <span class="function">onRender</span>: <span class="keyword">function</span>() {
        console.log(<span class="string"><span class="delimiter">'</span><span class="content">rendered!!</span><span class="delimiter">'</span></span>);
    }
});

<span class="comment">// j'appele la méthode render de la vue myView</span>
<span class="comment">// et aussi le callback qui y est attaché</span>
myView.triggerMethod(<span class="string"><span class="delimiter">'</span><span class="content">render</span><span class="delimiter">'</span></span>); 
</pre></div>
</div>
</div>

<h2 id="marionette-region">Marionette Region</h2>

<p>Une Region est un conteneur persistent pour un ensemble de child views. Ca te permet d’organiser ton code.</p>

<div><div class="CodeRay">
  <div class="code"><pre><span class="keyword">var</span> RootView = Mn.LayoutView.extend({
    <span class="key">el</span>: <span class="string"><span class="delimiter">'</span><span class="content">body</span><span class="delimiter">'</span></span>,

    <span class="key">regions</span>: {
        <span class="key">sidebar</span> : <span class="string"><span class="delimiter">'</span><span class="content">.sidebar</span><span class="delimiter">'</span></span>,
        <span class="key">main</span> : <span class="string"><span class="delimiter">'</span><span class="content">main</span><span class="delimiter">'</span></span>,
        <span class="key">footer</span> : <span class="string"><span class="delimiter">'</span><span class="content">footer</span><span class="delimiter">'</span></span>
    }
});

<span class="comment">// afficher une vie dans une partie de la Region</span>
rootView.getRegion(<span class="string"><span class="delimiter">'</span><span class="content">main</span><span class="delimiter">'</span></span>).show(<span class="keyword">new</span> MainView()); 
</pre></div>
</div>
</div>

<p>Cas des Vues imbriquées</p>

<div><div class="CodeRay">
  <div class="code"><pre>rootView.getRegion(<span class="string"><span class="delimiter">'</span><span class="content">main</span><span class="delimiter">'</span></span>).show(<span class="keyword">new</span> MainView());

<span class="keyword">var</span> MainView = Mn.LayoutView.extend({
    <span class="key">template</span>: mainViewTemplate,

    <span class="key">regions</span>: {
        <span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">.title</span><span class="delimiter">'</span></span>
    },

    <span class="comment">// methode éxécutée avant que la Vue Main soit affichée</span>
    <span class="function">onBeforeShow</span>: <span class="keyword">function</span>() {
        <span class="local-variable">this</span>.getRegion(<span class="string"><span class="delimiter">'</span><span class="content">title</span><span class="delimiter">'</span></span>).show(<span class="keyword">new</span> TitleView());
    }
});
</pre></div>
</div>
</div>

<h2 id="marionette-collectionview">Marionette CollectionView</h2>

<p>CollectionView fourni un système de liaison de donnée dans un sens (1-way data binding) entre la collection et les vues.</p>

<p>En Backbone, les collections permettent de faire plusieurs choses :</p>

<div><div class="CodeRay">
  <div class="code"><pre><span class="keyword">var</span> users = <span class="keyword">new</span> UsersCollection(); <span class="comment">// créer une collection</span>

users.length; <span class="comment">// connaître la taille d'une collection</span>

<span class="comment">// extraire un model d'une collection</span>
<span class="keyword">var</span> james = users.findWhere({ 
    <span class="key">firstname</span>: <span class="string"><span class="delimiter">'</span><span class="content">james</span><span class="delimiter">'</span></span>
});
</pre></div>
</div>
</div>

<p>Avec Marionette</p>

<div><div class="CodeRay">
  <div class="code"><pre><span class="keyword">var</span> UsersList = Mn.CollectionView.extend({
    <span class="key">collection</span>: users,
    <span class="key">childView</span>: UserView <span class="comment">// le type de vue que tu veux instancier pour chaque model de la vue !!</span>
});

<span class="comment">// j'affiche dans une Region ma Collection</span>
myRegion.show(<span class="keyword">new</span> UsersList()); 

<span class="comment">// puisque c'est 1-way-binding</span>
<span class="comment">// la vue va se mettre à jour automatiquement dans le navigateur</span>
users.remove(james); 
</pre></div>
</div>
</div>

<h2 id="rsum-sur-les-views">Résumé sur les Views</h2>

<p>Au niveau des Views dans Backbone+Marionette, il y a des bonnes choses et aussi des moins bonnes.</p>

<p>Quelques bonnes choses sont :</p>

<ul>
  <li>Tu ne te préoccupe pas du cablage des données;</li>
  <li>Tu ne te préoccupe pas de quand est-ce que tu dois afficher ta View.</li>
</ul>

<p>D’autres choses sont moins top :</p>

<ul>
  <li>Maintenant il y 4 classes de View avec Marionette (Views, CollectionViews, LayoutViews etc..)</li>
</ul>

<h2 id="architecture">Architecture</h2>

<p>Marionette.Object est une classe de base. Par exemple si tu veux créer un objet qui n’est pas une View ni une Collection ni quoi que ce soit de prédéfini dans Backbone, tu peux l’utiliser car il s’intégrera mieux dans le framework (plusieurs objet Marionette proviennent de Marionette.Object)</p>

<p>Backbone.Radio propose un système d’évènement plus robuste.</p>

<h2 id="marionette-routers">Marionette Routers</h2>

<h3 id="problme-avec-le-router">Problème avec le Router</h3>

<p>La philosophie de Backbone est que c’est le routage qui contrôle le flow de l’application. Une URI représente une action utilisateur.
Un click sur un bouton ou un lien doit avec son équivalence dans l’URL.
Ainsi cet exemple pose un “problème” car on est obligé de déclencher l’évènement au moment de la navigation :</p>

<div><div class="CodeRay">
  <div class="code"><pre><span class="keyword">var</span> router = <span class="keyword">new</span> Backbone.Router({
    <span class="key">routes</span> : {
        <span class="key"><span class="delimiter">'</span><span class="content">book/:id</span><span class="delimiter">'</span></span>: <span class="keyword">function</span>() {
            <span class="comment">// faire des trucs</span>
        },
        <span class="key"><span class="delimiter">'</span><span class="content">book/:bookId/chapter/:chapterId</span><span class="delimiter">'</span></span>: <span class="keyword">function</span>() {
            <span class="comment">// faire d'autres trucs</span>
        }
    }
});

router.navigate(<span class="string"><span class="delimiter">'</span><span class="content">book/3</span><span class="delimiter">'</span></span>); <span class="comment">// par défaut le callback spécifié dans le Router n'est pas exécuté</span>
router.navigate(<span class="string"><span class="delimiter">'</span><span class="content">book/3</span><span class="delimiter">'</span></span>, {<span class="key">trigger</span>: <span class="predefined-constant">true</span>}); <span class="comment">// déclenche le callback</span>
</pre></div>
</div>
</div>

<h3 id="state-router">State Router</h3>

<p>Toutes les choses suivantes sont faisaible en Backbone mais ne sont pas parfaites.</p>

<ul>
  <li>authentification / autorisation</li>
  <li>before / after callbacks</li>
  <li>redirections</li>
  <li>annulation</li>
  <li>routers imbriquées</li>
  <li>page 404</li>
</ul>

<p>Quelques solutions proposées par Marionette :</p>

<ul>
  <li>un objet peut être associé à une Route</li>
  <li>un objet possède deux rôle principales :
    1.  Récupérer les données
    2.  Montrer les Vues</li>
  <li>faciliter l’ajout de nouvelles actions à l’objet</li>
  <li>une action est exécutée à chaque changement d’URI</li>
</ul>

<p>Cette ensemble est nommé le State Router.</p>

<h3 id="base-router">Base Router</h3>

<p>Que faire si le State Router ne te convient pas ?</p>

<p>Marionette propose un Base Router. De base, Backbone fait des choix sur la manière de gérer les URIs. Par exemple, pour une Route donnée, une seule méthode va être appelée. Backbone Router analyse aussi les paramètres de la requête HTTP.</p>

<p>Le Base Router de Marionette s’affranchi des ces choix là.</p>

<h2 id="conclusion">Conclusion</h2>

<p>Pourquoi s’intéresser à Marionette ?
Marionette est en actif développement et possède une vision pour l’avenir. L’équipe principale est assez conséquente ainsi que la communauté. Marionette te facilite le développement Backbone ajoutant des fonctionnalités utiles pour structurer le code, surtout au niveau des Views.</p>

<p class="disclaimer">
    Article écrit à partir de la vidéo <a href="https://www.youtube.com/watch?v=EvQnntaqVdE">Marionette - The Backbone Framework</a>.<br />
    Une application Backbone + Marionette est disponible sur mon <a href="https://ptitgraig.github.com/first-steps-backbone-Marionette">GitHub</a> pour référence, qui utilise les principes fondamentaux présentés dans cet article.
</p>
]]>
		</content>
	</entry>
	
	<entry>
		
			<title type="html"><![CDATA[Une juste image de Dieu]]></title>
		
		<link href="http://ptitgraig.github.io/blog/2013/10/10/une-juste-image-de-dieu/"/>
		<updated>2013-10-10T09:37:00+02:00</updated>
		<id>http://ptitgraig.github.io/blog/2013/10/10/une-juste-image-de-dieu</id>
		<content type="html">
			<![CDATA[
				
					<p></p>
				
			]]>
			<![CDATA[<p class="foreword">
Premier chapitre du livre <em>Knowledge of the Holy</em> de A. W. Tozer. L&#8217;auteur argumente en faveur de l&#8217;importance cruciale d&#8217;une juste connaissance de Dieu.
</p>
<!-- more -->

<h3 id="chaptre-1">Chapître 1</h3>

<blockquote>
  <p>O Seigneur Dieu Tout Puissant, pas le Dieu des philosophes et des sages mais le Dieu des prophètes et des apôtres; et par dessus tout, le Dieu et Père de notre Seigneur Jésus-Christ, pourrais-je exprimer l’Ineffable ?</p>

  <p>Ceux qui ne Te connaissent pas peuvent faire appel à Toi comme si Tu étais autre, et ainsi donc ne pas T’adorer Toi mais une créature de leur propre imagination; ainsi donc, illumine notre intelligence afin que nous Te connaissions Tel que Tu Es, afin que nous puissions parfaitement aimer Celui qui Es et L’adorer comme il se doit.</p>
</blockquote>

<blockquote>
  <p>Dans le nom de Jésus-Christ notre Seigneur</p>
</blockquote>

<blockquote>
  <p>Amen</p>
</blockquote>

<p>Ce qui nous viens à l’esprit quand nous pensons à Dieu est en fait la chose la plus important qui nous concerne.</p>

<p>L’histoire de l’humanité va probablement montré qu’aucun peuple ne s’est jamais hissé au dessus de sa propre religion, et l’histoire spirituelle de l’Homme démontrera certainement qu’aucune religion n’a été plus grande que l’idée de Dieu qu’elle. La louange est pure ou basique selon les pensées que ce fait l’adorateur de Dieu.</p>

<p>Pour cette raison, la question la plus importante qui se pose à l’Eglise est la question de Dieu Lui-Même, et le fait le plus portentous au sujet d’un homme n’est pas ce qu’il dit ou fait à un moment donné mais l’image qu’il se fait de Dieu au plus profond de son coeur. Par une loi secrète de notre âme, nous avons tendance à nous rapprocher de l’image mentale que l’on se fait de Dieu. Cela est vrai non seulement pour le chrétien à l’échelle individuelle mais aussi pour les divers groupes de chrétiens qui composent l’Eglise.</p>

<p>La chose la plus révélatrice au sujet d’un église est l’idée qu’elle se fait de Dieu, tout comme son message le plus significatif est ce qu’elle dit à Son sujet..ou ne dit pas, car son silence est parfois plus éloquent que son discours. Elle ne pourra jamais échappé à une révélation d’elle même lors de son témoignage concernant Dieu.</p>

<p>Si Nous étions nous capable d’extraire de n’importe quel homme une réponse complète à la question ; “Qu’est ce qui vous viens à l’esprit quand vous penser à Dieu ?” nous pourrions prédire avec certitude, l’avenir spirituel de cet homme. Si nous soyons capable de déterminer l’image de Dieu qu’on nos plus influents dirigeants religieux aujourd’hui, nous serions également en mesure de prédire l’état de l’église demain.</p>

<p>Sans aucun doute, la pensée la plus puissante que l’esprit puisse entretenir est la pensée de Dieu et le mot le plus conséquent d’une langue est le mot qu’elle utilise pour Dieu. Pensées et discours sont des cadeaux de Dieu pour ses créatures faite à son image; celles-ci Lui sont intimement associé et inconcevable en dehors de Lui. Il est très pertinent que le premier mot soit la Parole. </p>

<p>“et la Parole était avec Dieu et la Parole était Dieu”.</p>

<p>Nous pouvons parler, car Dieu a parlé. En Lui, mots et idées sont indissociables.</p>

<p>Ainsi donc, que l’idée que nous nous faisons de Dieu soit la plus proche possible du Dieu véritable est de la plus haute importance pour nous. Comparé à nos pensées véritables à propos de lui, nos creedal déclarations ont très peu de conséquences. Notre véritable idée de Dieu est probablement enfoui très profondément sous un tas de détritus que sont nos notions religieuses conventionnelles et peut requérir une recherche intélligente et vigoureuse avant qu’enfin elle ne soit déterrée et exposé pour ce qu’elle est véritablement. Seulement après l’épreuve d’une introspection douloureuse sommes nous capable de découvrir ce que nous croyons vraiment au sujet de Dieu.</p>

<p>Une conception juste de Dieu est fondamental non seulement pour la théologie systématique mais aussi pour vivre la vie chrétienne de manière pratique.Il en va de la louange, ce que la fondation est au temple; là où ce n’est pas adéquate ou hors d’aplomb la structure finira tôt ou tard par s’écrouler.Je crois qu’il y a très peu d’erreurs doctrinale ou d’échec lors de l’application de l’éthique chrétienne qui ne soient pas du à des pensées imparfaites voir ignobles sur Dieu.</p>

<p>Mon opinion au sujet de la conception chrétienne de Dieu qui coure aujourd’hui ces années à la moitié du 20ème siècle est tellement décadente qu’elle en est au point d’être exagérément au dessous de la dignité du Dieu Très Saint. et constitue en fait pour les croyants professants quelque chose d’équivalent à une calamité morale.</p>

<p>Tout les problèmes de la terre et du ciel réunis, même rassemblé pour nous confronté d’un seul coup, ne serait rien comparé au problème submergeant de Dieu : qu’Il est, à comment est-Il, et ce que nous, créature doté du sens moral, devons nous faire à propos de Lui.</p>

<p class="disclaimer">
Ce texte ne constitue en aucun cas une traduction officielle. Elle est une tentative de l&#8217;auteur d&#8217;apporter aux lecteurs francophone la richesse de la reflexion de A. W. Tozer.
</p>
]]>
		</content>
	</entry>
	
	<entry>
		
			<title type="html"><![CDATA[Ce que j'aurai aimé savoir avant de me marier]]></title>
		
		<link href="http://ptitgraig.github.io/blog/2013/10/03/ce-que-jaurai-aime-savoir-avant-de-me-marier/"/>
		<updated>2013-10-03T18:52:00+02:00</updated>
		<id>http://ptitgraig.github.io/blog/2013/10/03/ce-que-jaurai-aime-savoir-avant-de-me-marier</id>
		<content type="html">
			<![CDATA[
				
					<p></p>
				
			]]>
			<![CDATA[
]]>
		</content>
	</entry>
	
	<entry>
		
			<title type="html"><![CDATA[Le chemin du calvaire]]></title>
		
		<link href="http://ptitgraig.github.io/blog/2013/10/03/le-chemin-du-calvaire/"/>
		<updated>2013-10-03T18:51:00+02:00</updated>
		<id>http://ptitgraig.github.io/blog/2013/10/03/le-chemin-du-calvaire</id>
		<content type="html">
			<![CDATA[
				
					<p></p>
				
			]]>
			<![CDATA[
]]>
		</content>
	</entry>
	
	<entry>
		
			<title type="html"><![CDATA[Javascript, les bons éléments]]></title>
		
		<link href="http://ptitgraig.github.io/blog/2013/10/03/javascript/"/>
		<updated>2013-10-03T18:51:00+02:00</updated>
		<id>http://ptitgraig.github.io/blog/2013/10/03/javascript</id>
		<content type="html">
			<![CDATA[
				
					<p></p>
				
			]]>
			<![CDATA[
]]>
		</content>
	</entry>
	
	<entry>
		
			<title type="html"><![CDATA[Un Dieu missionnaire]]></title>
		
		<link href="http://ptitgraig.github.io/blog/2013/09/17/un-dieu-missionnaire/"/>
		<updated>2013-09-17T14:22:00+02:00</updated>
		<id>http://ptitgraig.github.io/blog/2013/09/17/un-dieu-missionnaire</id>
		<content type="html">
			<![CDATA[
				
					<p></p>
				
			]]>
			<![CDATA[<p>« Notre Dieu est un Dieu missionnaire ». Telle est l’affirmation que nous pouvons entendre parfois dans les églises.
Essayons d’éprouver un peu cette affirmation.</p>

<!-- more -->

<h2 id="pourquoi-">1. Pourquoi ?</h2>

<p>Dans un premier temps, nous allons définir le terme mission. Pour répondre à cette question il nous faudra aussi dire quel est le but de la mission et ses implications. Enfin nous nous efforcerons de montrer que la mission est attachée au caractère de Dieu et qu’il est lui-même un Dieu missionnaire.</p>

<p>Mission signifie envoyer, en grec <em>apostelô</em> qui a donné apostolos, littéralement l’envoyé,  duquel on tire apôtre <sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup>. L’évangélisation est l’annonce de la bonne nouvelle (ange : annoncer, év : vient de eu qui signifie bon). La différence entre mission et évangélisation et que l’évangélisation fait partie de la mission. Elle est la réponse à l’appel de Dieu. Elle possède plusieurs facettes.
Historiquement, les frères moraves, au XVIIIème siècle, sont reconnus comme étant les premiers missionnaires modernes. Suite à la Réforme, Jean Hus, fonde 400 églises, qui formeront la fratrie Hussite, qui enverra de nombreux missionnaires par le monde.
Le but de la Mission est de faire connaître le vrai Dieu, Père, Fils Saint-Esprit aux hommes et qu’ils sachent ce qu’il a fait pour eux et attend d’eux. Cela n’implique pas seulement d’annoncer un message brut mais s’adapter à l’auditoire pour qu’il puisse saisir et accepter. Cela implique de considérer l’individu entièrement.
Nous voyons tout au long de l’histoire biblique d’Israël et de l’histoire de l’église que Dieu est un Dieu qui se révèle. Le fait d’envoyer, spécifique à la Bible, n’existe pas dans les autres religions <sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup>. Dieu s’intéresse à l’homme et veut lui communiquer  des messages mais lui donne pleine liberté par rapport à ceux-ci. Il s’adresse ainsi à Adam, Abraham, Moïse etc… Le but de Dieu est que les hommes le connaissent. La relation d’antan a été brisée à cause du péché et il faut la restaurer. Ainsi  Dieu n’est pas statique envers les hommes. Il est à la fois celui qui envoie et qui vient lui-même. Il va vers les hommes. Au sein même de la Tri-unité, le Père envoie le Fils sur la terre pour annoncer la venue du royaume de Dieu et accomplir sa volonté de mourir pour les pécheurs (Rom. 8.5). Le Père et le Fils envoient le Saint-Esprit sur toute chair pour sceller le salut de ceux qui croient (Act. 2.19). La parabole des vignerons 3 est une très bonne illustration du caractère missionnaire de Dieu. Il envoie ses serviteurs, les prophètes. Moïse est le premier pour qui la notion d’envoyer devient nette (Ex.3.10 : « Je t’envoie »). Puis fini par venir lui-même, en son Fils.
En venant, le Christ ne se contente pas d’annoncer la bonne nouvelle mais il s’occupe d’éduquer et de faire grandir dans la foi ceux qui l’écoutent et en particulier les 12. Ainsi, le Christ est un missionnaire entier. Il annonce la bonne nouvelle, s’occupe des individus pour les faire grandir dans leur foi. Il enseigne (Jean 6.6), prêche (Marc 1.14), s’occupe des besoins physiques <sup id="fnref:4"><a href="#fn:4" rel="footnote">3</a></sup> et spirituels de ceux à qui il s’adresse, et rend témoignage (Jean 5.36). Dès le début on dit que Jésus est envoyé (Heb3.1). Il est donc un apôtre.
Jésus-Christ lance un appel clair à faire de toutes les nations des disciples (Mat. 28.19). Il ne parle  pas simplement d’annoncer la bonne nouvelle aux nations mais d’en faire des disciples. Il parle donc  de la mission et de considérer les besoins des individus et leur croissance spirituelle. Jésus envoie lui-même ses disciples en mission. Notre Dieu est bien un Dieu missionnaire.</p>

<h2 id="comment-sy-prend-il--travers-lhistoire-selon-le-rcit-biblique-">2. Comment s’y prend-il à travers l’histoire selon le récit biblique ?</h2>

<p>Nous commencerons par voir de quelles manières Dieu se manifeste au travers de l’histoire d’Israël et de celle de l’Eglise. Puis nous tacherons de de voir comment Dieu s’y est pris pour se révéler, ce qu’il a utilisé pour que les hommes le connaisse.</p>

<p>Si nous prenons le récit biblique d’Israël dans son ensemble nous constatons que Dieu se révèle à son peuple de manière progressive. Il commence avec Abraham et ses descendants et se révèle ainsi aux hommes comme un Dieu qui s’intéresse à eux et leur fait des promesses. Il fait connaître son Nom à Moïse, et communique ainsi son essence d’être éternel : « Je suis celui est qui est ». Puis il se révèle comme celui qui veut faire une alliance avec son peuple. Il se manifeste comme celui qui est souverain et révèle sa perfection morale par la loi de Moïse. Ses règles et ses lois sont consignées par Moïse par écrit et sont conforme à sa volonté; Dieu revendique ces écrits comme son œuvre (Os. 8.12) <sup id="fnref:5"><a href="#fn:5" rel="footnote">4</a></sup>. Dieu se présente donc aux hommes de manière progressive. Toute la révélation de sa personne n’est pas donnée d’un seul coup.
Dieu se révèle aussi aux hommes par des hommes : les prophètes. Le prophète est celui que Dieu revêt de son autorité pour qu’il communique sa volonté aux hommes et les instruise <sup id="fnref:6"><a href="#fn:6" rel="footnote">5</a></sup>. En les inspirants par son Saint-Esprit, il communique à son peuple sa volonté.
Mais ce n’est qu’avec Jésus-Christ que Dieu se révèle pleinement aux hommes. En venant dans une chair semblable à la nôtre, Dieu se manifeste à la compréhension humaine de la meilleure manière qui soit. Par sa vie et son œuvre, Jésus a parfaitement révélé le Père (Jean 1.18) au point qu’il est appelé l’image du Dieu invisible (Heb. 1.3). Il fait connaître son plan de salut pour les hommes. Cette œuvre était symboliquement présente sous l’ancienne alliance par les sacrifices d’animaux sans défauts. Ainsi, Dieu, pendant des siècles, avait préparé son peuple à la venue de son Fils, celui qui le révèlerait entièrement et qui aurait à donner son sang, sa vie, pour les péchés.
Avant de rejoindre son Père, Jésus a commandé ses disciples de faire de toutes les nations ses disciples. C’est donc aux apôtres que Dieu a confié la mission de révéler qui il est au reste du monde (Act. 1.8). A l’heure de l’Eglise, la foi peut se reposer sur les textes bibliques, rédigés sous la plume inspirée des premiers apôtres du Christ. C’est le dépôt qui doit passer de générations en générations que Paul confie à Timothée (2Tim 1.12). L’Eglise est la garante du message de Dieu. Elle possède la clé pour le ciel (Mat 16.19), le moyen donné par Dieu d’avoir la certitude de la vie éternelle par la foi. Dieu continue de se révéler aux hommes qui ne le connaissent pas par les pierres vivantes de son Eglise et par son Saint-Esprit qui convainc les cœurs de péché. En prenant exemple sur les récits bibliques, nous constatons que Jésus et ses apôtres créaient un lien avec le vécu de leurs interlocuteurs afin d’annoncer la bonne nouvelle. La forme du message peut changer mais le fond reste identique. Ainsi Paul ne s’adresse pas de la même manière aux Athéniens (Act. 17.15-34) qu’Etienne, au sanhédrin (Act. 7). Ils considèrent leur culture, ce qu’ils savent déjà et leur quotidien et cherche à créer une passerelle entre l’Evangile et eux.</p>

<h2 id="comment-vivre-cette-mission-de-dieu-dans-votre-glise-aujourdhui-">3. Comment vivre cette mission de Dieu dans votre église aujourd’hui ?</h2>

<p>Nous allons dans un premier temps rappeler ce qu’implique la mission de Dieu. Puis dans quel contexte culturel est installée l’église en France. Enfin nous proposerons quelques pistes concrètes pour vivre cette mission.
Nous l’avons vu, elle a pour but de révéler Dieu, de le faire connaître par Jésus-Christ, de faire connaître sa volonté, et de faire des Hommes des disciples du Christ.
Pour vivre cela dans l’église aujourd’hui il faut considérer la culture dans laquelle elle est installée. En France, on perçoit le catholicisme comme la religion normale. On ne comprend pas que des églises de professant puissent exister. On revendique la tolérance mais on ne veut pas de la pluralité. La doctrine de l’Homme est mise en avant, l’Homme possède un « bon fond », ce qui ne va pas dans le sens de l’Evangile. Enfin, on remarque aussi un certain anticléricalisme bien que l’intérêt pour le Christianisme semble se renouveler.
Pour présenter Jésus à nos contemporains, il faut pouvoir créer des points de contact avec eux. David Brown suggère plusieurs passerelles pour atteindre nos contemporains : notre humanité, l’église, la spiritualité, le méta-récit <sup id="fnref:7"><a href="#fn:7" rel="footnote">6</a></sup>. Nous allons nous concentrer sur quelques-unes.
En commençant par cette passerelle que constitue notre humanité, l’identité et la valeur de l’être humain peuvent être discuté autour d’un repas organisé pendant une soirée sur un thème particulier. Par exemple, il serait possible de proposer d’inviter à l’église un missionnaire dont le ministère est rattaché aux enfants défavorisés pour qu’il puisse présenter son travail. La discussion sur ce sujet pourrait ferait alors naturellement pendant le repas, surtout si les invités sont déjà parents. Ainsi les valeurs de l’évangile seraient partagées.
Dans l’église, il est possible de mettre en place mensuellement des cultes « spéciaux » pendant lesquels, le vocabulaire utilisé sera accessible et le message approprié à un visiteur. Ainsi, chacun peut inviter un jour un collègue ou un ami à ce type de culte en sachant qu’il ne sera pas confronter à un « patois de Canaan ». Parallèlement l’église doit être sensibilisée à cela et chaque membre doit prendre ce projet à cœur, non pas seulement comme un projet personnel, mais aussi un projet d’église. Pour ceux qui voudraient aller plus loin, l’église peut mettre en place des rencontres pour présenter l’évangile clairement. Il est alors important de mettre également en place un suivi et d’entourer les personnes pour qu’elles puissent grandir dans leur foi. Les invités aux réunions de prières, aux études bibliques etc…
Mais avant toutes ces choses, puisque nos contemporains sont méfiants à l’égard des méta-récits, il convient de développer une relation de confiance. Ainsi, en allant boire un café ou en aidant à un déménagement, nous montrons de l’intérêt pour la personne et nous sommes en train d’évangéliser par notre vie. Instaurer une relation de confiance est donc capitale aujourd’hui.</p>

<blockquote>
  <p>Devoir également rédigé à l’aide de notes sur le stage « Evangélisation et Mission », D.Brown, FORMAPRE Nogent-sur-Marne.</p>
</blockquote>
<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>Mission, Nouveau Dictionnaire Biblique, Emmaüs, 2002<a href="#fnref:1" rel="reference">&#8617;</a></p>
    </li>
    <li id="fn:2">
      <p>Envoyer, Nouveau Dictionnaire Biblique, page 410, Emmaüs, 2002<a href="#fnref:2" rel="reference">&#8617;</a></p>
    </li>
    <li id="fn:4">
      <p>En Marc 6, Jésus nourrit la foule. En Marc 10, il guérit un aveugle né. En Luc 8, il chasse les démons.<a href="#fnref:4" rel="reference">&#8617;</a></p>
    </li>
    <li id="fn:5">
      <p>Prophète, Nouveau Dictionnaire Biblique, page 1066, Emmaüs, 2002<a href="#fnref:5" rel="reference">&#8617;</a></p>
    </li>
    <li id="fn:6">
      <p>Prophète, Nouveau Dictionnaire Biblique, page 1124, Emmaüs, 2002<a href="#fnref:6" rel="reference">&#8617;</a></p>
    </li>
    <li id="fn:7">
      <p>David Brown, Passerelles, Editions Farel, 2003, p.26<a href="#fnref:7" rel="reference">&#8617;</a></p>
    </li>
  </ol>
</div>
]]>
		</content>
	</entry>
	
	<entry>
		
			<title type="html"><![CDATA[Prouver la trinité, Bible en main]]></title>
		
		<link href="http://ptitgraig.github.io/blog/2013/09/17/prouver-la-trinite/"/>
		<updated>2013-09-17T14:02:00+02:00</updated>
		<id>http://ptitgraig.github.io/blog/2013/09/17/prouver-la-trinite</id>
		<content type="html">
			<![CDATA[
				
					<p></p>
				
			]]>
			<![CDATA[<p>Le mot Trinité, utilisé pour la première fois par Tertullien au IIème siècle, n’est pas employé dans la Bible. Tout d’abord présenté par Théophile d’Antioche sous le grec Triade, son enseignement est pourtant bien présent, en filigrane, tout au long des Ecritures. La 
doctrine de la Trinité peut se définir en 3 points fondamentaux inséparables.
<!-- more -->
Il n’y a qu’un seul Dieu. Le Père est Dieu, le Fils est Dieu et le Saint-Esprit est Dieu; en Dieu il y a 3 Personnes distinctes et de même nature. La difficulté vient du fait qu’il faille articuler ces 3 vérités ensemble sans les simplifier, sous peine de concevoir une hérésie. Avant tout travail, il est important de rappeler que nous resterons modestes quant à la compréhension de cette réalité. En effet, qui peut comprendre pleinement la nature d’un Dieu transcendant qui se tient hors de l’espace et du temps ?
Pour étayer la doctrine de la Trinité, nous allons nous appuyer sur les textes bibliques qui mettent en évidence ces vérités, successivement dans l’Ancien et le Nouveau Testament; il faut, bien entendu, reconnaître la parfaite fiabilité des textes bibliques. Nous commencerons par citer quelques versets affirmant l’existence d’un seul Dieu. La divinité du Père étant incontestable, nous chercherons dans un deuxième temps à démontrer la divinité du Fils puis celle du Saint-Esprit. Enfin, nous regarderons les textes qui soulignent que les 3 Personnes de la Trinité sont un seul et même Dieu.</p>

<p><span class="pullquote-right" data-pullquote="La Bible affirme avec force l&#8217;existence d&#8217;un seul Dieu">
Une constante, dans les 2 testaments, est la lutte contre les idoles et le polythéisme. La Bible affirme avec force l’existence d’un seul Dieu. Tout d’abord, les textes de l’Ancien Testament le soulignent. Citons-en quelques-uns. L’Ecriture commence avec le magistral « Au commencement, Dieu créa la terre et les cieux » (Gn1.1), qui d’emblée nous met face à un seul créateur. Il y a le premier des 10 commandements  « Je suis l’Eternel ton Dieu; tu n’auras point d’autres Dieu devant ma face » (Ex 20:2-3). Dieu lui-même affirme qu’il est un. Puis plus loin dans les Ecritures, nous trouvons également « Ecoute Israël, l’Eternel notre Dieu, l’Eternel est un » (Dt 6:4) qui est rappelé aux Israélites. Il y a aussi de nombreux textes soulignant qu’il n’y a qu’un seul Dieu dans le Nouveau Testament. Jésus, citant Moïse, affirme que Dieu est un (Mc 12:29). Paul, face à l’idolâtrie païenne, déclare publiquement l’existence d’un seul Créateur (Act 17:24-26).
Ce Dieu unique, notre Père (Es 63:16), est aussi appelé Fils. Les affirmations le montrant étant nombreuses, nous nous limiterons à quelques textes.
</span></p>

<p>Dans l’Ancien Testament, la divinité du Christ est claire. Il est écrit que le Messie sera le Fils de Dieu (Ps 2:2-9; 110:1) et même qu’il sera Dieu lui-même (Ps 45:7-8).
Certains textes du Nouveau Testament font références à Jésus quand il est question de Dieu dans l’Ancien Testament. Le chapitre 3 de Malachie parle du messager qui prépare la venue du Seigneur; ce texte est repris par les évangélistes pour parler de Jean-Baptiste préparant la venue de Jésus (Mat 11:10, Mc 1:2, Luc 7:27). Les versets 7 et 8 du Psaume 45, mentionnant un roi désigné par Dieu, appelé « Dieu » également, est repris par l’auteur de l’épître aux Hébreux pour désigner le Christ (Hb 1:8).
Les premiers paragraphes de l’évangile selon Jean présentent la Parole comme Dieu lui-même, éternel et créateur. Cette Parole s’est incarnée en Jésus (Jn 1:14). Jésus est donc Dieu homme. Paul dit de Jésus-Christ, qu’il est de condition divine, égal de Dieu (Ph 2:6-7). De nouveau, Jean dans son épître, écrit que Jésus-Christ est Fils de Dieu, le seul vrai Dieu et la vie éternelle (1 Jn:5:20). Ajoutons à cela que la naissance du Messie est annoncée dans les évangiles. Sa venue signifiera que Dieu est avec nous « Emmanuel » (Es 7:14). La venue du Fils de Dieu est annoncée aux hommes comme la venue de Dieu lui-même. Le nom Jésus porte la marque de la divinité : Jésus signifie « Dieu sauve », hors il n’y a que Dieu qui puisse sauver du péché. Son éternité est affirmée en Mi 5:1.
Jésus-Christ lui-même parle de sa divinité. Quand il s’applique à lui-même le « Je suis » de Yahvé (Jn 8:24), les juifs saisissent bien la référence et s’empressent de vouloir le tuer.</p>

<p>Penchons-nous maintenant sur les textes qui mettent en évidence la divinité du Saint-Esprit.
Dans l’Ancien Testament, quelques passages qui ramènent l’action de l’Esprit à celle de Dieu. Dans le Ps 104:29-30, le psalmiste reconnaît que l’Esprit donne vie à toute choses; Job dit la même chose (Job 3:34), hors c’est bien Dieu qui donne vie à toutes choses.
Dans le Nouveau Testament, Paul affirme aux Corinthiens qu’ils sont le temple de Dieu parce que l’Esprit habite en eux (1Cor 3:16). Dieu est partout et ses créatures sont limitées. Le Saint-Esprit est présent dans l’esprit de tous les croyants et c’est une chose que Dieu seul peut réaliser. Toujours dans l’épître aux Corinthiens, Paul affirme clairement : « Le Seigneur c’est l’Esprit » (2Cor 3:17). Mentir à l’Esprit c’est mentir à Dieu (Act 5:3-4) et l’Esprit agit et parle comme si il était Dieu lui-même (Act 13:2). Malgré son nom quelque peu impersonnel, le Saint-Esprit est une personne. Il parle et il est possible de l’attrister (Eph4:30).</p>

<p>Le dernier élément à démontrer est l’unité de ces 3 Personnes divines. Malgré leur distinction, elles sont unies. Cette unité apparaît aussi dans les textes bibliques. Premier panneau indicateur et détail probablement énigmatique pour les lecteurs de l’Ancien Testament, le premier verset de la Genèse commence en réalité avec « Au commencement les Dieux créa » (Gn 1:1). Elohim, qui est une forme du pluriel est suivie du verbe « créer » conjugué au  singulier. Dieu dit également après la chute « Voici l’homme est devenu comme l’un de nous … » (Gn 3:22). Autre élément « grammatical » pertinent : dans le Nouveau Testament, Jésus commande à ses disciples de baptiser au nom du Père du Fils et du Saint-Esprit et non pas aux noms. L’auteur, inspiré par le Saint-Esprit, a pris soin d’utiliser le singulier.
Toujours dans le Nouveau Testament, on constate l’unité dans l’action des 3 Personnes divines. Prenons quelques exemples seulement. Les 3 Personnes de la Tri-unité agissent ensemble lors de l’incarnation du Fils (Luc1:35). Ensuite, lors du baptême de Jésus, Le Père et L’Esprit se manifestent clairement (Mat 3:16-17). Jésus est rempli de joie par le Saint-Esprit et il remercie le Père dans sa prière (Luc 10:21). Il est également écrit que le Père, le Fils et le Saint-Esprit viennent (vient, conviendrait-il mieux ?) habiter dans le croyant (Jn 14:17,23). 2 Cor 13:13 est la bénédiction apostolique qui présente les 3 Personnes de la trinité ensemble. Nous finirons avec l’exemple de la Croix en Heb 9:14, où le Christ s’est offert lui-même à Dieu par l’Esprit. Le Salut n’est possible que par l’action unie de ces 3 Personnes, de Dieu.</p>

<p>L’Ecriture révèle un Dieu unique, cependant, elle révèle aussi 3 Personnes qui agissent ensemble, dans une parfaite relation d’amour (Jn 5:20), et qui partage la même nature divine. Nous touchons ici aux limites de notre compréhension humaine.
Comment comprendre qu’un Dieu solitaire pourrait concevoir le multiple - manifeste lors de la création - sans s’aliéner lui-même ? La Tri-unité permet de comprendre ce concept. En un Dieu unique, il existe la diversité (1 Cor12).
L’Ecriture, nous révèle, sans le dire de manière explicite que Dieu est unique et qu’en son sein vivent éternellement 3 Personnes unies totalement et de parfaite égalité. Cette révélation ne remet pas en cause le monothéisme mais nous montre que la nature de Dieu est bien plus inaccessible que nous pouvons le penser. C’est dans un sens c’est rassurant, car Dieu est bien un être inaccessible et transcendant. Sans une révélation de lui-même, par lui-même, nous ne pourrions le connaître. Pour les plus sceptiques qui verraient dans cette conclusion une sorte d’obscurantisme ou la traduction d’une foi charbonnière, admettons qu’il existe dans la création des similitudes comme l’âme humaine d’un individu. Elle est unique et cependant riche de sa diversité : intelligence, mémoire, volonté.</p>
]]>
		</content>
	</entry>
	
	<entry>
		
			<title type="html"><![CDATA[Créer un blog avec Octopress 100% gratuit, pour les nuls]]></title>
		
		<link href="http://ptitgraig.github.io/blog/2013/08/07/installer-octopress-en-10-etapes/"/>
		<updated>2013-08-07T00:50:00+02:00</updated>
		<id>http://ptitgraig.github.io/blog/2013/08/07/installer-octopress-en-10-etapes</id>
		<content type="html">
			<![CDATA[
				
					<p></p>
				
			]]>
			<![CDATA[<h2 id="introduction">Introduction</h2>

<p>Octopress est un moteur de blog statique. Qui dit statique, dit plusieurs avantages :</p>

<ol>
  <li>Léger</li>
  <li>Pas d’appels à une base de donnée</li>
  <li>Pas de script côté serveur</li>
  <li>Du coup c’est super rapide !!</li>
</ol>

<p>Tu ne connais pas Ruby, XCode mais tu aimerais bien avoir un blog sympa et rapide. 
Tu as trouvé Octopress après des recherches sur le net et tu t’es dit que tu voulais essayer. Cependant voilà, tu comprends pas bien l’anglais et quand tu suis les étapes sur le site officiel tu remarques qu’il manque plein de trucs sur ton Mac. Cette article est pour toi.
Dans 15 étapes, tu auras ton blog statique prêt à l’emploi pour pas un rond.</p>

<h2 id="installation-des-outils">Installation des outils</h2>

<ol>
  <li>
    <p>Ouvrir le terminal
Ctrl+espace, puis “Terminal” dans l’invite de recherche.</p>
  </li>
  <li>
    <p>Installer Xcode.
Dans l’appStore, chercher xcode. Cliquer sur le bouton “gratuit” (oui c’est gratuit :).</p>
  </li>
  <li>
    <p>Installer l’outil ligne de commande Xcode
Dans le menu de Xcode, <code>Xcode &gt; Préférences &gt; Downloads</code>, puis cliquer sur le bouton <code>install</code> en face de la ligne <code>Command Line Tool</code></p>
  </li>
  <li>
    <p>Installer RVM.
Dans le Terminal, lancer la commande suivante :</p>

    <div><div class="CodeRay">
  <div class="code"><pre>curl -L https://get.rvm.io | bash -s stable --ruby
</pre></div>
</div>
    </div>

    <p>Puis suivre les instructions proposées</p>
  </li>
  <li>
    <p>Installer Ruby 1.9.3
Dans le terminal, lancer les commandes suivantes :</p>

    <div><div class="CodeRay">
  <div class="code"><pre>rvm install 1.9.3
rvm use 1.9.3
rvm rubygems latest
</pre></div>
</div>
    </div>
  </li>
  <li>
    <p>Vérifier la version de Ruby</p>

    <div><div class="CodeRay">
  <div class="code"><pre>ruby --version
</pre></div>
</div>
    </div>

    <p>Le résultat doit contenir <code>ruby 1.9.3</code></p>
  </li>
</ol>

<h2 id="installation-doctopress">Installation d’Octopress</h2>

<ol>
  <li>
    <p>Se placer dans ton dossier de travail.</p>

    <div><div class="CodeRay">
  <div class="code"><pre>cd /chemin/vers/votre/dossier/de/travail
</pre></div>
</div>
    </div>

    <p>Personnellement je l’ai placé avec tous mes autres projets dans le dossier <code>/Applications/MAMP/htdocs</code></p>
  </li>
  <li>
    <p>Récupérer Octopress</p>

    <div><div class="CodeRay">
  <div class="code"><pre>git clone git://github.com/imathis/octopress.git octopress
cd octopress    # Vous utilisez RVM, On vous demandera de faire confiance au fichier .rvmrc (dites oui en tappant y).
ruby --version  # Ruby 1.9.3 devrait s'afficher
</pre></div>
</div>
    </div>
  </li>
  <li>
    <p>Installer les dépendances</p>

    <p>Saisir les commandes suivantes dans le Terminal</p>

    <div><div class="CodeRay">
  <div class="code"><pre>gem install bundler
rbenv rehash    # Si tu utilies rbenv, rehash afin de pouvoir exécuter la commande bundle
bundle install
</pre></div>
</div>
    </div>
  </li>
  <li>
    <p>Installer le thème d’Octopress par défaut</p>

    <div><div class="CodeRay">
  <div class="code"><pre>rake install
</pre></div>
</div>
    </div>
  </li>
</ol>

<h2 id="deployer-octopress-sur-internet-gratuitement">Deployer Octopress sur Internet gratuitement</h2>

<ol>
  <li>
    <p>Créer un compte GitHub
Se rendre sur <a href="http://www.github.com/">le site de GitHub</a> et créer un compte gratuitement.</p>
  </li>
  <li>
    <p>Créer un nouveau repository sur GitHub.
Sur GitHub, se rendre sur l’onglet <code>Repositories</code> et cliquer sur le bouton vert <code>new</code>.
Le nom que tu dois saisir doit être de la forme : <code>nom_du_blog.github.io</code>.</p>
  </li>
  <li>
    <p>Dire à Octopress de que tu veux mettre ton blog sur les pages GitHub</p>

    <div><div class="CodeRay">
  <div class="code"><pre>rake setup_github_pages
</pre></div>
</div>
    </div>

    <p>On te demandera de saisir un truc. Copie-colle <code>git@github.com:ton_pseudo_github/nom_du_blog.github.io.git</code>.</p>
  </li>
  <li>
    <p>Génère ton blog et publie-le ! Enfin.</p>

    <div><div class="CodeRay">
  <div class="code"><pre>rake generate
rake deploy
</pre></div>
</div>
    </div>
  </li>
</ol>

<h2 id="conclusion">Conclusion</h2>

<p>Ca y est ! Tu as ton blog maintenant disponible sur Internet et ça t’a pas coûté un kopeck. La vie est belle n’est-ce pas ?
Tu peux aller maintenant sur <code>http://nom_du_blog.github.io</code> et admirer ton beau travail.</p>

]]>
		</content>
	</entry>
	
</feed>
